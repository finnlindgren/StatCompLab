<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StatComp Project 1 (2020/21): Numerical statistics • StatCompLab</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="StatComp Project 1 (2020/21): Numerical statistics">
<meta property="og:description" content="Statistical Computing (2020/21): Coursework project 1">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">StatCompLab</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lab01.html">Lab01</a>
    </li>
    <li>
      <a href="../articles/Lab02.html">Lab02</a>
    </li>
    <li>
      <a href="../articles/Lab03.html">Lab03</a>
    </li>
    <li>
      <a href="../articles/Project01.html">StatComp Project 1 (2020/21): Numerical statistics</a>
    </li>
    <li>
      <a href="../articles/Project01Hints.html">Project 01 Hints</a>
    </li>
    <li>
      <a href="../articles/Tutorial01.html">Tutorial 01: R and linear models</a>
    </li>
    <li>
      <a href="../articles/Tutorial01Solutions.html">Tutorial 01: R and linear models (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial03.html">Tutorial 03: Monte Carlo integration</a>
    </li>
    <li>
      <a href="../articles/Tutorial03Solutions.html">Tutorial 03: Monte Carlo integration (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial04.html">Tutorial 04: Uncertainty and integration</a>
    </li>
    <li>
      <a href="../articles/Tutorial04Solutions.html">Tutorial 04: Uncertainty and integration (solutions)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/finnlindgren/StatCompLab/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Project01_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>StatComp Project 1 (2020/21): Numerical statistics</h1>
                        <h4 class="author">Finn Lindgren</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/finnlindgren/StatCompLab/blob/master/vignettes/Project01.Rmd"><code>vignettes/Project01.Rmd</code></a></small>
      <div class="hidden name"><code>Project01.Rmd</code></div>

    </div>

    
    
<p>This document can either be accessed in html form on (<a href="https://finnlindgren.github.io/StatCompLab/" class="uri">https://finnlindgren.github.io/StatCompLab/</a>), as a vignette in <code>StatCompLab</code> version 0.5.0 or later, with <code><a href="../articles/Project01.html">vignette("Project01", "StatCompLab")</a></code>, or in pdf format on Learn. Updated 2010-02-20 to add a more efficient alternative for the importance sampler in part 2.</p>
<ol style="list-style-type: decimal">
<li>You have been assigned a <code>project01-username</code> repository on (<a href="https://github.com/StatComp20/(https://github.com/StatComp20/" class="uri">https://github.com/StatComp20/(https://github.com/StatComp20/</a>). Use <code>git</code> to <em>clone</em> the repository (either to <a href="https://rstudio.cloud">https://rstudio.cloud</a> or your own computer) in the same way as the <code>lab02-username</code> repository in Lab 2.</li>
<li>The repository contains a template RMarkdown document, <code>report.Rmd</code>, that you should expand with your answers and solutions for this project assignment, and two code files, <code>code.R</code> containing some predefined functions, and <code>my_code.R</code> that should be used for some of your own code. Do not change these filenames.</li>
<li>Some of the code solutions (as indicated for those items) should be placed in the <code>my_code.R</code> file, and included in the report as indicated in the template document (also see the <code>RMdemo.Rmd</code>, <code>my_code.R</code>, and <code>T4sol.Rmd</code> document examples from the Week 4 lecture and example materials on Learn).</li>
<li>Code that is placed directly into code chunks in the <code>report.Rmd</code> file should be shown in a separate section at the end of the report, so that the main text is a coherent presentation of theory and discussion of methods and results. In the code presentation section, include a brief code comment for each chunk. Also include brief documentation as code comments before each function defined in <code>my_code.R</code>.</li>
<li>The <code>styler</code> package Addin for restyling code for better and consistent readability works for both <code>.R</code> and <code>.Rmd</code> files.</li>
</ol>
<p>The assignment is submitted by pushing your work to the github repository before your submission deadline. Make sure you include your name, student number, and github username in both <code>report.Rmd</code> and <code>my_code.R</code>. When submitting, also include a generated html version of the report, with filename <code>project.html</code>. Normally, generated images are automatically included in the html file itself; otherwise they need to be added to the repository as well.</p>
<p>It is strongly recommended to commit and push to github frequently. If you’re uncertain about whether you’re pushing all the needed submission files to github, ask Finn to check the repository contents <em>at least</em> a week before the submisison deadline.</p>
<p>The submission deadline is Monday 1 March 2021, at 16:00 (Edinburgh time). See the Assessment page on Learn for extensions and late submission penalty details.</p>
<p>The 10 sub-tasks contribute equally to the total mark, but the project will be marked as a whole, between <span class="math inline">\(0\)</span> and <span class="math inline">\(40\)</span>. A marking guide will be posted on Learn.</p>
<div style="page-break-after: always;"></div>
<div id="confidence-interval-approximation-assessment" class="section level1">
<h1 class="hasAnchor">
<a href="#confidence-interval-approximation-assessment" class="anchor"></a>Confidence interval approximation assessment</h1>
<p>As in Lab 4, consider the Poisson model for observations <span class="math inline">\(\boldsymbol{y}=\{y_1,\dots,y_n\}\)</span>: <span class="math display">\[
\begin{aligned}
y_i &amp; \sim \mathsf{Poisson}(\lambda), \quad\text{independent for $i=1,\dots,n$.}
\end{aligned}
\]</span> that has joint probability mass function <span class="math display">\[
p(\boldsymbol{y}|\lambda) = \exp(-n\lambda) \prod_{i=1}^n \frac{\lambda^{y_i}}{y_i!}
\]</span> In the lab, we considered three parameterisation alternatives:</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(\theta = \lambda\)</span>, and <span class="math inline">\(\widehat{\theta}_\text{ML}=\frac{1}{n}\sum_{i=1}^n y_i = \overline{y}\)</span>
</li>
<li>
<span class="math inline">\(\theta = \sqrt{\lambda}\)</span>, and <span class="math inline">\(\widehat{\theta}_\text{ML}=\sqrt{\overline{y}}\)</span>
</li>
<li>
<span class="math inline">\(\theta = \log(\lambda)\)</span>, and <span class="math inline">\(\widehat{\theta}_\text{ML}=\log\left(\overline{y}\right)\)</span>
</li>
</ol>
<p>We know that the inverse expected Fisher information is <span class="math inline">\(\lambda/n\)</span> for case 1, <span class="math inline">\(1/(4n)\)</span> for case 2, and <span class="math inline">\(1/(n\lambda)\)</span> for case 3.</p>
<p>In the lab, three functions, CI1, CI2, and CI3, were defined for constructing confidence intervals based on asymptotic Normal approximation for the Maximum Likelihood estimators in each of the parameterisations. For this project, you should use the function <code>pois_CI</code> that is defined in the <code>code.R</code> file in your project repository. The code file should be imported with the method shown in the <code>RMdemo.Rmd</code> file, but not displayed in the report. Look in the file for documentation of the functions.</p>
<p>The task is to do a simulation study to assess the accuracy of the three interval construction methods.</p>
<ol style="list-style-type: decimal">
<li>In your <code>my_code.R</code> file, define a function <code>multi_pois_CI(m, n, lambda, alpha,type)</code> that takes inputs <code>m</code>, indicating the number of simulations to perform, <code>n</code>, the number of observations used for each sample, and <code>lambda</code>, the true parameter value, as well as <code>alpha</code> and <code>type</code> with the same interpretation as for <code>pois_CI</code>. The function must return a data frame with <code>m</code> rows and two columns, named <code>Lower</code> and <code>Upper</code> containing the confidence intervals, one for each row.</li>
<li>Show mathematically that the widths of the <span class="math inline">\(\lambda\)</span>-intervals for parameterisation type 1 and 2 are always identical to each other, for any given observation vector <span class="math inline">\(\boldsymbol{y}\)</span> and confidence level <span class="math inline">\(1-\alpha\)</span>. Note: You should ignore the cases where the <span class="math inline">\(\theta\)</span>- or <span class="math inline">\(\lambda\)</span>-intervals extend below <span class="math inline">\(0\)</span> (for case 1, when the normal quantile <span class="math inline">\(z\)</span> has <span class="math inline">\(\overline{y} &lt; z^2/n\)</span>, and for case 2, when <span class="math inline">\(4\overline{y} &lt; z^2/n\)</span>).</li>
<li>In your <code>my_code.R</code> file, define a function <code>tidy_multi_pois_CI(m, n, lambda, alpha)</code> that takes the same inputs as <code>multi_pois_CI</code> except for the <code>type</code> argument. The function must return a data frame with <code>3*m</code> rows and three columns, named <code>Lower</code>, <code>Upper</code>, and <code>Type</code> containing the confidence intervals from three calls to <code>multi_pois_CI</code>, with the <code>Type</code> column containing values 1, 2, or 3 to indicate which method calculated each interval.</li>
<li>With the help of <code>tidy_multi_pois_CI</code>, estimate the coverage probability for nominal confidence level <span class="math inline">\(1-\alpha\)</span>=90%, for each of the three interval types, for <span class="math inline">\(n=2\)</span>, <span class="math inline">\(\lambda=3\)</span>, using <span class="math inline">\(m\)</span> at least <span class="math inline">\(100000\)</span>. How well do the coverage probabilities match the nominal confidence level for each method? With the <code>tidyverse</code> package loaded, the <code>group_by</code> and <code>summarise</code> functions can be used to avoid direct indexing or loops. Summarise and discuss the results.</li>
<li>Plot the empirical CDFs for the interval widths for the three methods, in a common figure. Use <code><a href="https://rdrr.io/r/base/factor.html">factor(Type)</a></code> to group the information by colour. Also compute the median interval width for each method. Summarise and discuss the results.</li>
</ol>
<div style="page-break-after: always;"></div>
</div>
<div id="archaeology-in-the-baltic-sea" class="section level1">
<h1 class="hasAnchor">
<a href="#archaeology-in-the-baltic-sea" class="anchor"></a>Archaeology in the Baltic Sea</h1>
<p>In Lab 3, you investigated data from an archaeological excavation on Gotland in the Baltic sea. In the 1920s, a battle gravesite from 1361 was subject to several archaeological excavations. A total of <span class="math inline">\(493\)</span> femurs (thigh bones) (<span class="math inline">\(256\)</span> left, and <span class="math inline">\(237\)</span> right) were found. We wanted to figure out how many persons were likely buried at the gravesite. It must reasonably have been at least <span class="math inline">\(256\)</span>, but how many more? In this assignment, you will use importance sampling to estimate credible intervals for this problem.</p>
<p>In the lab, it seemed difficult to extract much information from the sample, since there were only two observations and two parameters. You will here investigate if including data from other excavations of the same type might decrease the uncertainty about the number of persons buried, through improved information about the average detection probability, <span class="math inline">\(\phi\)</span>. The function <code>arch_data</code> in <code>code.R</code> returns a data frame with data for up to four different excavations (note: only one of them is real; the other three are synthetic data generated for this assignment).</p>
<p>We assume the same model as in the lab for each excavation, with an unknown <span class="math inline">\(N_j\)</span>, <span class="math inline">\(j=1,\dots,J\)</span>, for each of the <span class="math inline">\(J\)</span> excavations, and a common detection probability <span class="math inline">\(\phi\)</span>. We assume them model that, conditionally on <span class="math inline">\(\{N_j\}\)</span> and <span class="math inline">\(\phi\)</span>, <span class="math inline">\((Y_{j,i}|N_j,\phi)\sim\mathsf{Bin}(N_j,\phi)\)</span>, <span class="math inline">\(i=1,2\)</span>, all independent, and prior distributions <span class="math inline">\(N_j\sim\mathsf{Geom}(\xi)\)</span>, <span class="math inline">\(0&lt;\xi&lt;1\)</span>, and <span class="math inline">\(\phi\sim\mathsf{Beta}(a, b)\)</span>, <span class="math inline">\(a,b&gt;0\)</span>, <span class="math display">\[
\begin{aligned}
p_{Y_{j,i}|N_j=n,\phi}(y) = \mathsf{P}(Y_{j,i}=y|N_j=n,\phi) &amp;= {n \choose y} \phi^y(1-\phi)^{n-y},
\quad y=0,\dots,n, \\
p_{N_j}(n) = \mathsf{P}(N_j=n) &amp;= \xi\,(1-\xi)^n,\quad n=0,1,2,3,\dots, \\
p_\phi(\phi) &amp;= \frac{\phi^{a-1}(1-\phi)^{b-1}}{B(a,b)}, \quad \phi\in(0,1) ,
\end{aligned}
\]</span> where <span class="math inline">\(B(a,b)\)</span> is the <em>Beta function</em>, see <code><a href="https://rdrr.io/r/base/Special.html">?beta</a></code> in R.</p>
<div id="joint-probability-function-for-boldsymbolnboldsymboly" class="section level2">
<h2 class="hasAnchor">
<a href="#joint-probability-function-for-boldsymbolnboldsymboly" class="anchor"></a>Joint probability function for <span class="math inline">\((\boldsymbol{N},\boldsymbol{Y})\)</span>
</h2>
<p>Conditionally on <span class="math inline">\(\boldsymbol{N}=\{N_1,\dots,N_J\}\)</span>, and the observations <span class="math inline">\(\boldsymbol{Y}\)</span>, the conditional posterior distribution for <span class="math inline">\((\phi|\boldsymbol{N},\boldsymbol{Y})\)</span> is <span class="math inline">\(\mathsf{Beta}(\widetilde{a},\widetilde{b})\)</span> where <span class="math inline">\(\widetilde{a}=a+\sum_{j,i} Y_{j,i}\)</span> and <span class="math inline">\(\widetilde{b}=b+2\sum_j N_j -\sum_{j,i} Y_{j,i}\)</span>, and the sums go over <span class="math inline">\(j=1,\dots,J\)</span> and <span class="math inline">\(i=1,2\)</span>.</p>
<p>Show that the joint probability function for <span class="math inline">\((\boldsymbol{N},\boldsymbol{Y})\)</span>, with <span class="math inline">\(N_j\geq\max(Y_{j,1},Y_{j,2})\)</span> and <span class="math inline">\(Y_{j,i}=0,1,2,\dots\)</span>, is given by<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> <span class="math display">\[
p(\boldsymbol{N},\boldsymbol{Y}) = \frac{B(\widetilde{a},\widetilde{b})}{B(a,b)} \prod_{j=1}^J \left[
p(N_j)
\prod_{i=1}^2
{N_j \choose Y_{j,i}}
\right],
\]</span> where <span class="math inline">\(p(N_j)\)</span> is the probability mass function for the Geometric distribution prior for <span class="math inline">\(N_j\)</span>.</p>
</div>
<div id="probability-function-implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#probability-function-implementation" class="anchor"></a>Probability function implementation</h2>
<p>With the help of the functions <code>lbeta</code>, <code>lchoose</code>, and <code>dgeom</code>, define (in <code>my_code.R</code>) a function <code>log_prob_NY(N,Y,xi,a,b)</code> with arguments <code>N</code> (a vector of length <span class="math inline">\(J\)</span>) and <span class="math inline">\(Y\)</span> (a data frame of size <span class="math inline">\(J\times 2\)</span>, formatted like the output from <code>arch_data(J)</code>). The arguments <code>xi</code>, <code>a</code>, <code>b</code> are the model hyperparameters <span class="math inline">\(\xi\)</span>, <span class="math inline">\(a\)</span>, and <span class="math inline">\(b\)</span>. The function should return the logarithm of <span class="math inline">\(p(\boldsymbol{N},\boldsymbol{Y})\)</span> when the combination of <span class="math inline">\(\boldsymbol{N}\)</span> and <span class="math inline">\(\boldsymbol{Y}\)</span> is valid, and should otherwise return <code>-Inf</code>.</p>
</div>
<div id="importance-sampling-function" class="section level2">
<h2 class="hasAnchor">
<a href="#importance-sampling-function" class="anchor"></a>Importance sampling function</h2>
<p>The aim is to construct a Bayesian credible interval for each <span class="math inline">\(N_j\)</span> using importance sampling, similarly to the method used in lab 4. There, a Gaussian approximation of the posterior of a parameter was used. Here, we will instead use the prior distribution for <span class="math inline">\(\boldsymbol{N}\)</span> as sampling distribution, with samples <span class="math inline">\(N_j^{[k]}\sim\mathsf{Geom}(\xi)\)</span>.</p>
<p>Since the observations <span class="math inline">\(\boldsymbol{Y}\)</span> are fixed, the posterior probability function <span class="math inline">\(p(\boldsymbol{N}|\boldsymbol{Y})\)</span> for <span class="math inline">\(\boldsymbol{N}\)</span> is proportional to <span class="math inline">\(p(\boldsymbol{N},\boldsymbol{Y})\)</span>.</p>
<p>We define the logarithm of unnormalised importance weights, <span class="math inline">\(\log[w^{[k]}]=\log[p(\boldsymbol{N}^{[k]},\boldsymbol{Y})]-\log[p(\boldsymbol{N}^{[k]})]\)</span>, where <span class="math inline">\(p(\boldsymbol{N}^{[k]})\)</span> is the product of <span class="math inline">\(J\)</span> geometric distribution probabilities.</p>
<p>Define (in <code>my_code.R</code>) a function <code>arch_importance(K,Y,xi,a,b)</code> with the same arguments <code>Y</code>, <code>xi</code>, <code>a</code>, and <code>b</code> as before, but with the first argument <code>K</code> defining the number of samples to generate. The function should return a data frame with <span class="math inline">\(K\)</span> rows and <span class="math inline">\(J+1\)</span> columns, named <code>N1</code>, <code>N2</code>, etc, for each <span class="math inline">\(j=1,\dots,J\)</span>, containing samples from the prior distributions for <span class="math inline">\(N_j\)</span>, and a final column called <code>Log_Weights</code>, containing re-normalised log-importance-weights, constructed by shifting <span class="math inline">\(\log[w^{[k]}]\)</span> by subtracting the largest <span class="math inline">\(\log[w^{[k]}]\)</span> value, as in lab 4.</p>
<div id="more-efficient-alternative" class="section level3">
<h3 class="hasAnchor">
<a href="#more-efficient-alternative" class="anchor"></a>More efficient alternative</h3>
<p>Using the <span class="math inline">\(\mathsf{Geom}(\xi)\)</span> prior distribution for each <span class="math inline">\(N_j\)</span> leads to a rather inefficient importance sampler, especially for <span class="math inline">\(J=4\)</span>; Most of the weights will become zero (when some <span class="math inline">\(N_j^{[k]}&lt;Y_{j,i}\)</span>) or near zeros, and only a few samples will influence the practical estimates and credible intervals.</p>
<p>As an alternative, we can use sampling distributions that are better adapted to the posterior distributions. Let <span class="math inline">\(N^\text{min}_j=\max(Y_{j,1}, Y_{j,2})\)</span> be the smallest allowed value to sample, for each <span class="math inline">\(j=1,\dots,J\)</span>. This would eliminate all the impossible combinations, so that all weights would be (in theory if not numerically) positive.</p>
<p>To further improve the method, we can choose different values of the probability parameter for the samples, and also adapt it differently for each <span class="math inline">\(j\)</span>. Without motivation, you can use values <span class="math inline">\(\xi_j=1/(1 + 4 N^\text{min}_j)\)</span> when sampling, so that <span class="math inline">\(N_j^{[k]}=N^\text{min}_j + \mathsf{Geom}(\xi_j)\)</span>.</p>
<p>Note: Due to the nature of the geometric distribution, this is also equivalent to an ordinary <span class="math inline">\(\mathsf{Geom}(\xi_j)\)</span> conditioned on being at least <span class="math inline">\(N^\text{min}_j\)</span>.</p>
<p>To take this different sampling method into account, the log-weights need to be defined as <span class="math inline">\(\log[w^{[k]}]=\log[p(\boldsymbol{N}^{[k]},\boldsymbol{Y})]-\log[\widetilde{p}(\boldsymbol{N}^{[k]})]\)</span>, where <span class="math inline">\(\widetilde{p}(\boldsymbol{N}^{[k]})=\prod_{j=1}^J p_{\mathsf{Geom}(\xi_j)}(N_j^{[k]}-N^\text{min}_j)\)</span>, the product of <span class="math inline">\(J\)</span> different geometric distribution probabilities.</p>
<p>You may adapt this example code (the details will depend on which vectorisation method you use):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># matrix of minimum allowed N for each j, repeated K times</span>
<span class="va">N_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">Y</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span>, <span class="va">K</span>, <span class="va">J</span><span class="op">)</span>
<span class="va">xi_sample</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">N_min</span><span class="op">)</span>
<span class="co"># Sample values and call log_prob_NY for each sample,</span>
<span class="co"># store N-values in a K-by-J matrix, and log(p_NY)-values in a vector log_PY</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html">rgeom</a></span><span class="op">(</span><span class="va">...</span>, prob <span class="op">=</span> <span class="va">xi_sample</span><span class="op">)</span>, <span class="va">K</span>, <span class="va">J</span><span class="op">)</span> <span class="op">+</span> <span class="va">N_min</span>
<span class="va">log_PY</span> <span class="op">&lt;-</span> <span class="va">...</span>
<span class="co"># Subtract the sampling log-probabilities</span>
<span class="va">log_PY</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html">dgeom</a></span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">N_min</span>, prob <span class="op">=</span> <span class="va">xi_sample</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Using this method, <span class="math inline">\(K\)</span> doesn’t need to be larger than <span class="math inline">\(100000\)</span>, as small as <span class="math inline">\(K=1000\)</span> starts to give reasonable values for code testing purposes, and <span class="math inline">\(K=10000\)</span> should only take at most a few seconds to run if the code is fully vectorised (the <code>vapply</code> function can be used, but a basic <code>for</code>-loop is also fine in this case).</p>
</div>
</div>
<div id="credible-intervals-for-n_j" class="section level2">
<h2 class="hasAnchor">
<a href="#credible-intervals-for-n_j" class="anchor"></a>Credible intervals for <span class="math inline">\(N_j\)</span>
</h2>
<p>As in the lab, let <span class="math inline">\(\xi=1/1001\)</span>, and <span class="math inline">\(a=b=1/2\)</span>. Use <code>arch_importance</code> and the <code>wquantile</code> function with <code>type=1</code> (see the help text for information) to compute credible intervals for <span class="math inline">\(N_j\)</span>. Start by including only the data from a single excavation, and observe how the interval for <span class="math inline">\(N_1\)</span> changes when data from the other excavations are added. Present and discuss the results.</p>
</div>
<div id="credible-intervals-for-phi" class="section level2">
<h2 class="hasAnchor">
<a href="#credible-intervals-for-phi" class="anchor"></a>Credible intervals for <span class="math inline">\(\phi\)</span>
</h2>
<p>Update<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> the <code>arch_importance</code> function to add a column <code>Phi</code> with samples from the conditional distribution <span class="math inline">\(\mathsf{Beta}(\widetilde{a},\widetilde{b})\)</span> for each row of the importance sample. Use the updated function to construct credible intervals for <span class="math inline">\(\phi\)</span>, one for <span class="math inline">\(J=1\)</span>, and one for <span class="math inline">\(J=4\)</span>. Present and discuss the results.</p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Binomial coefficients can be notated with <code>{N \choose k}</code> in LaTeX formulas.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Note: your final submission should only contain the updated function.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
