<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>StatComp Project 1 (2022/23): Simulation and sampling â€¢ StatCompLab</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="StatComp Project 1 (2022/23): Simulation and sampling">
<meta name="description" content="Statistical Computing (2022/23): Coursework project 1">
<meta property="og:description" content="Statistical Computing (2022/23): Coursework project 1">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">StatCompLab</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">25.4.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Project_Example_Solution.html">StatComp Project Example Solution: Numerical Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/Project_Example.html">StatComp Project Example: Numerical statistics</a></li>
    <li><a class="dropdown-item" href="../articles/Project01.html">StatComp Project 1 (2022/23): Simulation and sampling</a></li>
    <li><a class="dropdown-item" href="../articles/Project01Hints.html">StatComp Project 1 (2022/23): Hints</a></li>
    <li><a class="dropdown-item" href="../articles/Project02.html">StatComp Project 2: Scottish weather</a></li>
    <li><a class="dropdown-item" href="../articles/Project02Hints.html">StatComp Project 2 (2022/23): Hints</a></li>
    <li><a class="dropdown-item" href="../articles/Quiz1Solution.html">Quiz 1 Solution (StatComp 2021/22)</a></li>
    <li><a class="dropdown-item" href="../articles/T4sol.html">Tutorial 04: Uncertainty and integration (full solution)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial01.html">Tutorial 01: R and linear models</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial01Solutions.html">Tutorial 01: R and linear models (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial02.html">Tutorial 02: Optimization</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial02Solutions.html">Tutorial 02: Optimization (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial03.html">Tutorial 03: Monte Carlo integration</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial03Solutions.html">Tutorial 03: Monte Carlo integration (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial04.html">Tutorial 04: Uncertainty and integration</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial04Solutions.html">Tutorial 04: Uncertainty and integration (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial06.html">Tutorial 06: Prediction assessment with proper scores</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial06Solutions.html">Tutorial 06: Prediction assessment with proper scores (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial07.html">Tutorial 07: Data wrangling and cross validation</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial07Solutions.html">Tutorial 07: Data wrangling and cross validation (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial08.html">Tutorial 08: Floating point computations and least squares</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial08Solutions.html">Tutorial 08: Floating point computations and least squares (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial09.html">Tutorial 09: Bootstrap and Pareto smoothed importance sampling</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial09Solutions.html">Tutorial 09: Bootstrap and Pareto smoothed importance sampling (solutions)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/finnlindgren/StatCompLab/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>StatComp Project 1 (2022/23): Simulation and sampling</h1>
                        <h4 data-toc-skip class="author">Finn
Lindgren</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/finnlindgren/StatCompLab/blob/main/vignettes/Project01.Rmd" class="external-link"><code>vignettes/Project01.Rmd</code></a></small>
      <div class="d-none name"><code>Project01.Rmd</code></div>
    </div>

    
    
<p>This document can either be accessed in html form on <a href="https://finnlindgren.github.io/StatCompLab/">https://finnlindgren.github.io/StatCompLab/</a>,
as a vignette in <code>StatCompLab</code> version 21.4.1 or later, with
<code><a href="../articles/Project01.html">vignette("Project01", "StatCompLab")</a></code>, or in pdf format on
Learn.</p>
<p>Use the template material in the zip file <code>project01.zip</code>
in Learn to write your report. Add all your function definitions on the
<code>code.R</code> file and write your report using
<code>report.Rmd</code>. You must upload the following three files as
part of this assignment: <code>code.R</code>, <code>report.html</code>,
<code>report.Rmd</code>. Specific instructions for these files are in
the <code>README.md</code> file.</p>
<p>The main text in your report should be a coherent presentation of
theory and discussion of methods and results, showing code for code
chunks that perform computations and analysis but not code for code
chunks that generate figures or tables.</p>
<p>Use the <code>echo=TRUE</code> and <code>echo=FALSE</code> to control
what code is visible.</p>
<p>The <code>styler</code> package addin is useful for restyling code
for better and consistent readability. It works for both <code>.R</code>
and <code>.Rmd</code> files.</p>
<p>The <code>Project01Hints</code> file contains some useful tip and
<code>CWmarking</code> contain guidelines. Both are attached in Learn as
pdf files.</p>
<p>Submission should be done through Gradescope.</p>
<div class="section level2">
<h2 id="confidence-interval-approximation-assessment">Confidence interval approximation assessment<a class="anchor" aria-label="anchor" href="#confidence-interval-approximation-assessment"></a>
</h2>
<p>As in Lab 4, consider the Poisson model for observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ²</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\boldsymbol{y}=\{y_1,\dots,y_n\}</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>y</mi><mi>i</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi>ğ–¯</mi><mi>ğ—ˆ</mi><mi>ğ—‚</mi><mi>ğ—Œ</mi><mi>ğ—Œ</mi><mi>ğ—ˆ</mi><mi>ğ—‡</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î»</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mrow><mrow><mtext mathvariant="normal">independent for </mtext><mspace width="0.333em"></mspace></mrow><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>n</mi></mrow><mtext mathvariant="normal">.</mtext></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
y_i &amp; \sim \mathsf{Poisson}(\lambda), \quad\text{independent for $i=1,\dots,n$.}
\end{aligned}
</annotation></semantics></math> that has joint probability mass
function
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ²</mi><mo stretchy="false" form="prefix">|</mo><mi>Î»</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>âˆ’</mo><mi>n</mi><mi>Î»</mi><mo stretchy="true" form="postfix">)</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><msup><mi>Î»</mi><msub><mi>y</mi><mi>i</mi></msub></msup><mrow><msub><mi>y</mi><mi>i</mi></msub><mi>!</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
p(\boldsymbol{y}|\lambda) = \exp(-n\lambda) \prod_{i=1}^n \frac{\lambda^{y_i}}{y_i!}
</annotation></semantics></math> In Lab 4, one of the considered
parameterisation alternatives was</p>
<ol style="list-style-type: decimal">
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi><mo>=</mo><mi>Î»</mi></mrow><annotation encoding="application/x-tex">\theta = \lambda</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Î¸</mi><mo accent="true">Ì‚</mo></mover><mtext mathvariant="normal">ML</mtext></msub><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mover><mi>y</mi><mo accent="true">Â¯</mo></mover></mrow><annotation encoding="application/x-tex">\widehat{\theta}_\text{ML}=\frac{1}{n}\sum_{i=1}^n y_i = \overline{y}</annotation></semantics></math>
</li>
</ol>
<p>Create a function called <code>estimate_coverage</code> (in
<code>code.R</code>; also document the function) to perform interval
coverage estimation taking arguments <code>CI</code> (a function object
for confidence interval construction taking arguments <code>y</code> and
<code>alpha</code> and returning a 2-element vector [see Lab 4]),
<code>N</code> (the number of simulation replications to use for the
coverage estimate), <code>alpha</code> (1-<code>alpha</code> is the
intended coverage probability), <code>n</code> (the sample size) and
<code>lambda</code> (the true <code>lambda</code> values for the Poisson
model).</p>
<p>Use your function <code>estimate_coverage</code> to estimate the
coverage of the construction of confidence intervals from samples
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>ğ–¯</mi><mi>ğ—ˆ</mi><mi>ğ—‚</mi><mi>ğ—Œ</mi><mi>ğ—Œ</mi><mi>ğ—ˆ</mi><mi>ğ—‡</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î»</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathsf{Poisson}(\lambda)</annotation></semantics></math>
and discuss the following:</p>
<ul>
<li>Since the model involves the discrete Poisson distribution, one
might ask how sensitive these results are to the precise values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î»</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>.
To investigate this, run the coverage estimation for different
combinations of model parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î»</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
(fix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>10000</mn></mrow><annotation encoding="application/x-tex">N = 10000</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\alpha=0.1</annotation></semantics></math>)</li>
<li>Present your results of estimated coverage in two plots, (1) as a
function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î»</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
for fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n=2</annotation></semantics></math>,
and (2) as a function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
for fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î»</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\lambda=3</annotation></semantics></math>.</li>
<li>Discuss the plots in regards to whether the coverage of the
intervals achieve the desired 90% confidence level, and if not identify
under which cases and provide a suggestion as to why.</li>
</ul>
<div style="page-break-after: always;"></div>
</div>
<div class="section level2">
<h2 id="d-printer-materials-prediction">3D printer materials prediction<a class="anchor" aria-label="anchor" href="#d-printer-materials-prediction"></a>
</h2>
<p>The aim is to estimate the parameters of a Bayesian statistical model
of material use in a 3D printer. The printer uses rolls of
<em>filament</em> that get heated and squeezed through a moving nozzle,
gradually building objects. The objects are first designed in a CAD
program (Computer Aided Design) that also estimates how much material
will be required to print the object.</p>
<p>The data can be loaded with
<code>data("filament1", package = "StatCompLab")</code>, and contains
information about one 3D-printed object per row. The columns are</p>
<ul>
<li>
<code>Index</code>: an observation index</li>
<li>
<code>Date</code>: printing dates</li>
<li>
<code>Material</code>: the printing material, identified by its
colour</li>
<li>
<code>CAD_Weight</code>: the object weight (in grams) that the CAD
software calculated</li>
<li>
<code>Actual_Weight</code>: the actual weight of the object (in
grams) after printing</li>
</ul>
<p>If the CAD system and printer were both perfect, the
<code>CAD_Weight</code> and <code>Actual_Weight</code> values would be
equal for each object. In reality, there are random variations, for
example, due to varying humidity and temperature, and systematic
deviations due to the CAD system not having perfect information about
the properties of the printing materials.</p>
<p>When looking at the data (see below) itâ€™s clear that the variability
of the data is larger for larger values of <code>CAD_Weight</code>. The
printer operator has made a simple physics analysis, and settled on a
model where the connection between <code>CAD_Weight</code> and
<code>Actual_Weight</code> follows a linear model, and the variance
increases with square of <code>CAD_Weight</code>. If we denote the CAD
weight for observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
by <code>x_i</code>, and the corresponding actual weight by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>,
the model can be defined by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mrow><mi>ğ–­</mi><mi>ğ—ˆ</mi><mi>ğ—‹</mi><mi>ğ—†</mi><mi>ğ–º</mi><mi>ğ—…</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>+</mo><msub><mi>Î²</mi><mn>2</mn></msub><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Î²</mi><mn>3</mn></msub><mo>+</mo><msub><mi>Î²</mi><mn>4</mn></msub><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="false" form="postfix">)</mo><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
y_i \sim \mathsf{Normal}[\beta_1 + \beta_2 x_i, \beta_3 + \beta_4 x_i^2)] .
</annotation></semantics></math> To ensure positivity of the variance,
the parameterisation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›‰</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î¸</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Î¸</mi><mn>2</mn></msub><mo>,</mo><msub><mi>Î¸</mi><mn>3</mn></msub><mo>,</mo><msub><mi>Î¸</mi><mn>4</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Î²</mi><mn>2</mn></msub><mo>,</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î²</mi><mn>4</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\theta}=[\theta_1,\theta_2,\theta_3,\theta_4]=[\beta_1,\beta_2,\log(\beta_3),\log(\beta_4)]</annotation></semantics></math>
is introduced, and the printer operator assigns independent prior
distributions as follows:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¸</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi>ğ–­</mi><mi>ğ—ˆ</mi><mi>ğ—‹</mi><mi>ğ—†</mi><mi>ğ–º</mi><mi>ğ—…</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>Î³</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¸</mi><mn>2</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi>ğ–­</mi><mi>ğ—ˆ</mi><mi>ğ—‹</mi><mi>ğ—†</mi><mi>ğ–º</mi><mi>ğ—…</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><msub><mi>Î³</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¸</mi><mn>3</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi>ğ–«</mi><mi>ğ—ˆ</mi><mi>ğ—€</mi><mi>ğ–¤</mi><mi>ğ—‘</mi><mi>ğ—‰</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î³</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¸</mi><mn>4</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi>ğ–«</mi><mi>ğ—ˆ</mi><mi>ğ—€</mi><mi>ğ–¤</mi><mi>ğ—‘</mi><mi>ğ—‰</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î³</mi><mn>4</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\theta_1 &amp;\sim \mathsf{Normal}(0,\gamma_1), \\
\theta_2 &amp;\sim \mathsf{Normal}(1,\gamma_2), \\
\theta_3 &amp;\sim \mathsf{LogExp}(\gamma_3), \\
\theta_4 &amp;\sim \mathsf{LogExp}(\gamma_4),
\end{aligned}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>ğ–«</mi><mi>ğ—ˆ</mi><mi>ğ—€</mi><mi>ğ–¤</mi><mi>ğ—‘</mi><mi>ğ—‰</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathsf{LogExp}(a)</annotation></semantics></math>
denotes the logarithm of an exponentially distributed random variable
with rate parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>,
as seen in Tutorial 4. The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›„</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î³</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Î³</mi><mn>2</mn></msub><mo>,</mo><msub><mi>Î³</mi><mn>3</mn></msub><mo>,</mo><msub><mi>Î³</mi><mn>4</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\gamma}=(\gamma_1,\gamma_2,\gamma_3,\gamma_4)</annotation></semantics></math>
values are positive parameters.</p>
<p>The printer operator reasons that due to random fluctuations in the
material properties (such as the density) and room temperature should
lead to a <em>relative</em> error instead of an additive error, which
leads them to the model as an approximation of that. The basic physics
assumption is that the error in the CAD software calculation of the
weight is proportional to the weight itself.</p>
<p>Start by loading the data and plotting it.</p>
<div class="section level3">
<h3 id="prior-density">Prior density<a class="anchor" aria-label="anchor" href="#prior-density"></a>
</h3>
<p>With the help of <code>dnorm</code> and the <code>dlogexp</code>
function (see the <code>code.R</code> file for documentation), define
and document (in <code>code.R</code>) a function
<code>log_prior_density</code> with arguments <code>theta</code> and
<code>params</code>, where theta is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›‰</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>
parameter vector, and <code>params</code> is the vector of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›„</mi><annotation encoding="application/x-tex">\boldsymbol{\gamma}</annotation></semantics></math>
parameters. Your function should evaluate the logarithm of the joint
prior density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‰</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\boldsymbol{\theta})</annotation></semantics></math>
for the four
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¸</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\theta_i</annotation></semantics></math>
parameters.</p>
</div>
<div class="section level3">
<h3 id="observation-likelihood">Observation likelihood<a class="anchor" aria-label="anchor" href="#observation-likelihood"></a>
</h3>
<p>With the help of <code>dnorm</code>, define and document a function
<code>log_like</code>, taking arguments <code>theta</code>,
<code>x</code>, and <code>y</code>, that evaluates the observation
log-likelihood
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ²</mi><mo stretchy="false" form="prefix">|</mo><mi>ğ›‰</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\boldsymbol{y}|\boldsymbol{\theta})</annotation></semantics></math>
for the model defined above.</p>
</div>
<div class="section level3">
<h3 id="posterior-density">Posterior density<a class="anchor" aria-label="anchor" href="#posterior-density"></a>
</h3>
<p>Define and document a function <code>log_posterior_density</code>
with arguments <code>theta</code>, <code>x</code>, <code>y</code>, and
<code>params</code>, which evaluates the logarithm of the posterior
density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‰</mi><mo stretchy="false" form="prefix">|</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\boldsymbol{\theta}|\boldsymbol{y})</annotation></semantics></math>,
apart from some unevaluated normalisation constant.</p>
</div>
<div class="section level3">
<h3 id="posterior-mode">Posterior mode<a class="anchor" aria-label="anchor" href="#posterior-mode"></a>
</h3>
<p>Define a function <code>posterior_mode</code> with arguments
<code>theta_start</code>, <code>x</code>, <code>y</code>, and
<code>params</code>, that uses <code>optim</code> together with the
<code>log_posterior_density</code> and filament data to find the mode
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\mu}</annotation></semantics></math>
of the log-posterior-density and evaluates the Hessian at the mode as
well as the inverse of the negated Hessian,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ’</mi><annotation encoding="application/x-tex">\boldsymbol{S}</annotation></semantics></math>.
This function should return a list with elements <code>mode</code> (the
posterior mode location), <code>hessian</code> (the Hessian of the
log-density at the mode), and <code>S</code> (the inverse of the negated
Hessian at the mode). See the documentation for <code>optim</code> for
how to do maximisation instead of minimisation.</p>
</div>
<div class="section level3">
<h3 id="gaussian-approximation">Gaussian approximation<a class="anchor" aria-label="anchor" href="#gaussian-approximation"></a>
</h3>
<p>Let all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î³</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\gamma_i=1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">i=1,2,3,4</annotation></semantics></math>,
and use <code>posterior_mode</code> to evaluate the inverse of the
negated Hessian at the mode, in order to obtain a multivariate Normal
approximation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>ğ–­</mi><mi>ğ—ˆ</mi><mi>ğ—‹</mi><mi>ğ—†</mi><mi>ğ–º</mi><mi>ğ—…</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo>,</mo><mi>ğ’</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathsf{Normal}(\boldsymbol{\mu},\boldsymbol{S})</annotation></semantics></math>
to the posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›‰</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>.
Use start values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›‰</mi><mo>=</mo><mn>ğŸ</mn></mrow><annotation encoding="application/x-tex">\boldsymbol{\theta} = \boldsymbol{0}</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="importance-sampling-function">Importance sampling function<a class="anchor" aria-label="anchor" href="#importance-sampling-function"></a>
</h3>
<p>The aim is to construct a 90% Bayesian credible interval for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\beta_j</annotation></semantics></math>
using importance sampling, similarly to the method used in lab 4. There,
a one dimensional Gaussian approximation of the posterior of a parameter
was used. Here, we will instead use a multivariate Normal approximation
as the importance sampling distribution. The functions
<code>rmvnorm</code> and <code>dmvnorm</code> in the
<code>mvtnorm</code> package can be used to sample and evaluate
densities.</p>
<p>Define and document a function <code>do_importance</code> taking
arguments <code>N</code> (the number of samples to generate),
<code>mu</code> (the mean vector for the importance distribution), and
<code>S</code> (the covariance matrix), and other additional parameters
that are needed by the function code.</p>
<p>The function should output a <code>data.frame</code> with five
columns, <code>beta1</code>, <code>beta2</code>, <code>beta3</code>,
<code>beta4</code>, <code>log_weights</code>, containing the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\beta_i</annotation></semantics></math>
samples and normalised
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>log</mo><annotation encoding="application/x-tex">\log</annotation></semantics></math>-importance-weights,
so that <code>sum(exp(log_weights))</code> is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>.
Use the <code>log_sum_exp</code> function (see the <code>code.R</code>
file for documentation) to compute the needed normalisation
information.</p>
</div>
<div class="section level3">
<h3 id="importance-sampling">Importance sampling<a class="anchor" aria-label="anchor" href="#importance-sampling"></a>
</h3>
<p>Use your defined functions to compute an importance sample of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>10000</mn></mrow><annotation encoding="application/x-tex">N=10000</annotation></semantics></math>.
Plot the empirical weighted CDFs together with the un-weighted CDFs for
each parameter, with the help of <code>stat_ewcdf</code>, and discuss
the results. To achieve simpler <code>ggplot</code> code, you may find
<code>pivot_longer(???, starts_with("beta"))</code> and
<code>facet_wrap(vars(name))</code> useful.</p>
<p>Construct 90% credible intervals for each of the four model
parameters, based on the importance sample. In addition to
<code>wquantile</code> and <code>pivot_longer</code>, the methods
<code>group_by</code> and <code>summarise</code> are helpful. You may
wish to define a function <code>make_CI</code> taking arguments
<code>x</code>, <code>weights</code>, and <code>prob</code> (to control
the intended</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
