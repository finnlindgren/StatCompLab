<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project 01 Hints • StatCompLab</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Project 01 Hints">
<meta property="og:description" content="StatCompLab">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">StatCompLab</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lab01.html">Lab01</a>
    </li>
    <li>
      <a href="../articles/Lab02.html">Lab02</a>
    </li>
    <li>
      <a href="../articles/Lab03.html">Lab03</a>
    </li>
    <li>
      <a href="../articles/Project01.html">StatComp Project 1 (2020/21): Numerical statistics</a>
    </li>
    <li>
      <a href="../articles/Project01Hints.html">Project 01 Hints</a>
    </li>
    <li>
      <a href="../articles/Tutorial01.html">Tutorial 01: R and linear models</a>
    </li>
    <li>
      <a href="../articles/Tutorial01Solutions.html">Tutorial 01: R and linear models (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial03.html">Tutorial 03: Monte Carlo integration</a>
    </li>
    <li>
      <a href="../articles/Tutorial03Solutions.html">Tutorial 03: Monte Carlo integration (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial04.html">Tutorial 04: Uncertainty and integration</a>
    </li>
    <li>
      <a href="../articles/Tutorial04Solutions.html">Tutorial 04: Uncertainty and integration (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial06.html">Tutorial 06: Prediction assessment with proper scores</a>
    </li>
    <li>
      <a href="../articles/Tutorial06Solutions.html">Tutorial 06: Prediction assessment with proper scores (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial07.html">Tutorial 07: Data wrangling and cross validation</a>
    </li>
    <li>
      <a href="../articles/Tutorial07Solutions.html">Tutorial 07: Data wrangling and cross validation (solutions)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/finnlindgren/StatCompLab/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Project01Hints_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Project 01 Hints</h1>
                        <h4 class="author">Finn Lindgren</h4>
            
            <h4 class="date">2021-03-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/finnlindgren/StatCompLab/blob/master/vignettes/Project01Hints.Rmd"><code>vignettes/Project01Hints.Rmd</code></a></small>
      <div class="hidden name"><code>Project01Hints.Rmd</code></div>

    </div>

    
    
<div id="avoiding-long-running-times" class="section level1">
<h1 class="hasAnchor">
<a href="#avoiding-long-running-times" class="anchor"></a>Avoiding long running times</h1>
<div id="the-problem" class="section level2">
<h2 class="hasAnchor">
<a href="#the-problem" class="anchor"></a>The problem</h2>
<p>Collecting the confidence intervals into a data.frame inside a loop can be slow.</p>
<p>A common issue when combining results computed in loops is that using <code>rbind</code> in each step of the loop to add one or a few rows to a large vector or data.frame can be very slow; instead of linear computational cost in the size of the output, the cost can become quadratic; it needs to reallocate memory and copy the previous results, for each new version of the result object.</p>
</div>
<div id="the-solution" class="section level2">
<h2 class="hasAnchor">
<a href="#the-solution" class="anchor"></a>The solution</h2>
<p>The key is to avoid reallocating memory by instead pre-allocating the whole result object before the loop. However there are some subtleties to this, and the examples blow show the differences between approaches.</p>
<p>A common solution is to work with simpler intermediate data structures within the loop, and then collect the results at the end. Indexing into simple vectors is much cheaper than reallocating and copying memory.</p>
<p>Slow:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">slow_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">loop</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>
      <span class="va">result</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
  <span class="va">result</span>
<span class="op">}</span></code></pre></div>
<p>Better, but even data.frame indexing assignments causes some memory reallocation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">better_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">loop</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">result</span><span class="op">[</span><span class="va">loop</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">result</span>
<span class="op">}</span></code></pre></div>
<p>Fast; several orders of magnitude faster (see timings below) by avoiding memory reallocation inside the loop:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fast_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
  <span class="va">result_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">loop</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">result_A</span><span class="op">[</span><span class="va">loop</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span>
    <span class="va">result_B</span><span class="op">[</span><span class="va">loop</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    A <span class="op">=</span> <span class="va">result_A</span>,
    B <span class="op">=</span> <span class="va">result_B</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Not as fast, but a bit more compact; using matrix indexing doesn’t need memory reallocation, but is a bit slower than vector indexing. A potential drawback is that his method only works when all the columns in the output data.frame should be of the same type (numeric).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ok_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">N</span>, <span class="fl">2</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">loop</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">result</span><span class="op">[</span><span class="va">loop</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">loop</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Benchmark timing comparisons:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bench/man/mark.html">mark</a></span><span class="op">(</span>
  slow <span class="op">=</span> <span class="fu">slow_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,
  better <span class="op">=</span> <span class="fu">better_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,
  fast <span class="op">=</span> <span class="fu">fast_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,
  ok <span class="op">=</span> <span class="fu">ok_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is disabled.</span>
<span class="co">#&gt; # A tibble: 4 x 6</span>
<span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span>
<span class="co">#&gt;   &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 slow        357.5ms  361.8ms      2.76    27.6MB     9.67</span>
<span class="co">#&gt; 2 better       47.9ms   53.4ms     18.9     15.9MB    13.3 </span>
<span class="co">#&gt; 3 fast        356.2µs  429.2µs   2264.        89KB     6.00</span>
<span class="co">#&gt; 4 ok          678.1µs  782.5µs   1089.     106.4KB    20.0</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bench/man/mark.html">mark</a></span><span class="op">(</span>
  slow <span class="op">=</span> <span class="fu">slow_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,
  better <span class="op">=</span> <span class="fu">better_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,
  fast <span class="op">=</span> <span class="fu">fast_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,
  ok <span class="op">=</span> <span class="fu">ok_fun</span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is disabled.</span>
<span class="co">#&gt; # A tibble: 4 x 6</span>
<span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span>
<span class="co">#&gt;   &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 slow          5.39s    5.39s     0.186    2.28GB    12.4 </span>
<span class="co">#&gt; 2 better     799.27ms 799.27ms     1.25     1.49GB    38.8 </span>
<span class="co">#&gt; 3 fast         2.28ms    2.6ms   383.     156.34KB     2.00</span>
<span class="co">#&gt; 4 ok           6.63ms   7.11ms   109.     390.86KB     9.90</span></code></pre></div>
</div>
</div>
<div id="dynamically-generated-column-names" class="section level1">
<h1 class="hasAnchor">
<a href="#dynamically-generated-column-names" class="anchor"></a>Dynamically generated column names</h1>
<p>When the size of a matrix or data.frame depends on a parameter, e.g. <span class="math display">\[J\]</span> in the second part of the project, we sometimes need a way to dynamically generate column names. The <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> function can be used for this.</p>
<p>For example, if we want a data.frame of size <span class="math inline">\(n\times m\)</span>, with column names <code>Name1</code>, <code>Name2</code>, etc, we can use</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># Create a matrix with some values in it</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<p>The resulting object looks like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span>
<span class="co">#&gt;       Name1      Name2     Name3</span>
<span class="co">#&gt; 1 0.5751548 0.11950345 0.8366353</span>
<span class="co">#&gt; 2 0.1971988 0.57743745 0.1065894</span>
<span class="co">#&gt; 3 0.8512820 0.06890278 0.4630850</span>
<span class="co">#&gt; 4 0.4720534 0.33482033 0.3364013</span>
<span class="co">#&gt; 5 0.3490320 0.60785552 0.7521589</span></code></pre></div>
</div>
<div id="avoiding-unnecessary-for-loops" class="section level1">
<h1 class="hasAnchor">
<a href="#avoiding-unnecessary-for-loops" class="anchor"></a>Avoiding unnecessary for-loops</h1>
<p>Since most operations and functions in R are vectorised, the code can often be written in a clear way by avoiding unnecessary for-loops. As a simple example, say that we want to compute <span class="math inline">\(\sum_{k=1}^{100} \cos(k)\)</span>.</p>
<p>A for-loop solution of the style that would be a good solution in a high performance low-level language like C might look like this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>By taking advantage of vectorised calling of <code><a href="https://rdrr.io/r/base/Trig.html">cos()</a></code>, and the function <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, we can reformulate into a shorter and more clear vectorised solution:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Other commonly used functions involving vectors of <code>TRUE</code> and <code>FALSE</code> are <code><a href="https://rdrr.io/r/base/all.html">all()</a></code> and <code><a href="https://rdrr.io/r/base/any.html">any()</a></code>. For example,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="co"># FALSE == 0, TRUE == 1</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>Both <code>sum</code>, <code>any</code>, and <code>all</code> also operate across all elements of a matrix. For row-wise and column-wise sums, see <code><a href="https://rdrr.io/r/base/colSums.html">rowSums()</a></code>and <code><a href="https://rdrr.io/r/base/colSums.html">colSums()</a></code>.</p>
</div>
<div id="latex-equations" class="section level1">
<h1 class="hasAnchor">
<a href="#latex-equations" class="anchor"></a>LaTeX equations</h1>
<div id="aligning-equations-in-multi-step-derivations" class="section level2">
<h2 class="hasAnchor">
<a href="#aligning-equations-in-multi-step-derivations" class="anchor"></a>Aligning equations in multi-step derivations</h2>
<p>When typesetting multi-step derivations, one should align the equations. In LaTeX, this can be done with the <code>align</code> or <code>align*</code> environments. In some case, that might not work in RMarkdown, but one can then use the <code>aligned</code> environment instead.</p>
<div id="example-1" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h3>
<pre><code>\begin{align*}
\frac{\partial}{\partial x}f(x, y) &amp;= \frac{\partial}{\partial x}\exp(2x+3y) \\
&amp;= 2\exp(2x+3y)
\end{align*}</code></pre>
<p>Result:</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial}{\partial x}f(x, y) &amp;= \frac{\partial}{\partial x}\exp(2x+3y) \\
&amp;= 2\exp(2x+3y)
\end{align*}\]</span></p>
</div>
<div id="example-2" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h3>
<pre><code>$$
\begin{aligned}
\frac{\partial}{\partial x}f(x, y) &amp;= \frac{\partial}{\partial x}\exp(2x+3y) \\
&amp;= 2\exp(2x+3y)
\end{aligned}
$$</code></pre>
<p>Result:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial x}f(x, y) &amp;= \frac{\partial}{\partial x}\exp(2x+3y) \\
&amp;= 2\exp(2x+3y)
\end{aligned}
\]</span></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
