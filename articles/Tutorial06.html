<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tutorial 06: Prediction assessment with proper scores • StatCompLab</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial 06: Prediction assessment with proper scores">
<meta name="description" content="Statistical Computing: Lab tutorial 6">
<meta property="og:description" content="Statistical Computing: Lab tutorial 6">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">StatCompLab</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">25.4.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Project_Example_Solution.html">StatComp Project Example Solution: Numerical Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/Project_Example.html">StatComp Project Example: Numerical statistics</a></li>
    <li><a class="dropdown-item" href="../articles/Project01.html">StatComp Project 1 (2022/23): Simulation and sampling</a></li>
    <li><a class="dropdown-item" href="../articles/Project01Hints.html">StatComp Project 1 (2022/23): Hints</a></li>
    <li><a class="dropdown-item" href="../articles/Project02.html">StatComp Project 2: Scottish weather</a></li>
    <li><a class="dropdown-item" href="../articles/Project02Hints.html">StatComp Project 2 (2022/23): Hints</a></li>
    <li><a class="dropdown-item" href="../articles/Quiz1Solution.html">Quiz 1 Solution (StatComp 2021/22)</a></li>
    <li><a class="dropdown-item" href="../articles/T4sol.html">Tutorial 04: Uncertainty and integration (full solution)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial01.html">Tutorial 01: R and linear models</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial01Solutions.html">Tutorial 01: R and linear models (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial02.html">Tutorial 02: Optimization</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial02Solutions.html">Tutorial 02: Optimization (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial03.html">Tutorial 03: Monte Carlo integration</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial03Solutions.html">Tutorial 03: Monte Carlo integration (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial04.html">Tutorial 04: Uncertainty and integration</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial04Solutions.html">Tutorial 04: Uncertainty and integration (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial06.html">Tutorial 06: Prediction assessment with proper scores</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial06Solutions.html">Tutorial 06: Prediction assessment with proper scores (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial07.html">Tutorial 07: Data wrangling and cross validation</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial07Solutions.html">Tutorial 07: Data wrangling and cross validation (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial08.html">Tutorial 08: Floating point computations and least squares</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial08Solutions.html">Tutorial 08: Floating point computations and least squares (solutions)</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial09.html">Tutorial 09: Bootstrap and Pareto smoothed importance sampling</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial09Solutions.html">Tutorial 09: Bootstrap and Pareto smoothed importance sampling (solutions)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/finnlindgren/StatCompLab/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tutorial 06: Prediction assessment with proper scores</h1>
                        <h4 data-toc-skip class="author">Finn
Lindgren</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/finnlindgren/StatCompLab/blob/main/vignettes/Tutorial06.Rmd" class="external-link"><code>vignettes/Tutorial06.Rmd</code></a></small>
      <div class="d-none name"><code>Tutorial06.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this lab session you will explore</p>
<ul>
<li>Probabilistic prediction and proper scores</li>
</ul>
<ol style="list-style-type: decimal">
<li>Open your github repository clone project from Tutorial 2 or 4
(either on <a href="https://rstudio.cloud" class="external-link">https://rstudio.cloud</a> on
your own computer, and upgrade the <code>StatCompLab</code>
package.</li>
<li>During this lab, you can either work in a <code>.R</code> file or a
new <code>.Rmd</code> file.</li>
</ol>
<hr>
<p><strong>Solution:</strong></p>
<p>The accompanying <code>Tutorial06Solutions</code> tutorial/vignette
documents contain the solutions explicitly, to make it easier to review
the material after the workshops.</p>
<hr>
</div>
<div class="section level2">
<h2 id="d-printer">3D printer<a class="anchor" aria-label="anchor" href="#d-printer"></a>
</h2>
<p>The aim is to build and assess statistical models of material use in
a 3D printer.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Special thanks to Sten Lindgren for providing the
printer data.&lt;/p&gt;"><sup>1</sup></a> The printer uses rolls of <em>filament</em>
that gets heated and squeezed through a moving nozzle, gradually
building objects. The objects are first designed in a CAD program
(Computer Aided Design), that also estimates how much material will be
required to print the object.</p>
<p>The data can be loaded with
<code>data("filament1", package = "StatCompLab")</code>, and contains
information about one 3D-printed object per row. The columns are</p>
<ul>
<li>
<code>Index</code>: an observation index</li>
<li>
<code>Date</code>: printing dates</li>
<li>
<code>Material</code>: the printing material, identified by its
colour</li>
<li>
<code>CAD_Weight</code>: the object weight (in gram) that the CAD
software calculated</li>
<li>
<code>Actual_Weight</code>: the actual weight of the object (in
gram) after printing</li>
</ul>
<p>If the CAD system and printer were both perfect, the
<code>CAD_Weight</code> and <code>Actual_Weight</code> values would be
equal for each object. In reality, there is both random variation, for
example due to varying humidity and temperature, and systematic
deviations due to the CAD system not having perfect information about
the properties of the printing materials.</p>
<p>When looking at the data (see below) it’s clear that the variability
of the data is larger for larger values of <code>CAD_Weight</code>. The
printer operator wants to know which of two models, named A and B, are
better at capturing the distributions of the random deviations.</p>
<p>Both models use a linear model for coneection between
<code>CAD_Weight</code> and <code>Actual_Weight</code>. We denote the
CAD weight for observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
by <code>x_i</code>, and the corresponding actual weight by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>.
The two models are defined by</p>
<ul>
<li>Model A:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∼</mo><mrow><mi>𝖭</mi><mi>𝗈</mi><mi>𝗋</mi><mi>𝗆</mi><mi>𝖺</mi><mi>𝗅</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>+</mo><msub><mi>θ</mi><mn>2</mn></msub><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mn>3</mn></msub><mo>+</mo><msub><mi>θ</mi><mn>4</mn></msub><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim \mathsf{Normal}[\theta_1 + \theta_2 x_i, \exp(\theta_3 + \theta_4 x_i)]</annotation></semantics></math>
</li>
<li>Model B:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∼</mo><mrow><mi>𝖭</mi><mi>𝗈</mi><mi>𝗋</mi><mi>𝗆</mi><mi>𝖺</mi><mi>𝗅</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>+</mo><msub><mi>θ</mi><mn>2</mn></msub><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mn>4</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="false" form="postfix">)</mo><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim \mathsf{Normal}[\theta_1 + \theta_2 x_i, \exp(\theta_3) + \exp(\theta_4) x_i^2)]</annotation></semantics></math>
</li>
</ul>
<p>The printer operator reasons that due to random fluctuations in the
material properties (such as the density) and room temperature should
lead to a <em>relative</em> error instead of an additive error, and this
leads them to model B as an approximation of that. The basic physics
assumption is that the error in the CAD software calculation of the
weight is proportional to the weight itself. Model A on the other hand
is slightly more mathematically convenient, but has no such motivation
in physics.</p>
<p>Start by loading the data and plot it.</p>
<!--

<img src="Tutorial06_files/figure-html/load-data-show-1.png" width="576" />
-->
</div>
<div class="section level2">
<h2 id="estimate-and-predict">Estimate and predict<a class="anchor" aria-label="anchor" href="#estimate-and-predict"></a>
</h2>
<p>Next week, we will assess model predictions using cross validation,
where data is split into separate parts for parameter estimation and
prediction assessment, in order to avoid or reduce bias in the
prediction assessments. For simplicity this week, we will start by using
the entire data set for both parameter estimation and prediction
assessment.</p>
<div class="section level3">
<h3 id="estimate">Estimate<a class="anchor" aria-label="anchor" href="#estimate"></a>
</h3>
<p>First, use <code><a href="../reference/filament1_estimate.html">filament1_estimate()</a></code> from the
<code>StatCompLab</code> package to estimate the two models A and B
using the <code>filament1</code> data. See the help text for
information.</p>
<!--


-->
</div>
<div class="section level3">
<h3 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h3>
<p>Next, use <code><a href="../reference/filament1_predict.html">filament1_predict()</a></code> to compute probabilistic
predictions of <code>Actual_Weight</code> using the two estimated
models.</p>
<!--


-->
<p>Inspect the predictions by drawing figures, e.g. with
<code>geom_ribbon(aes(CAD_Weight, ymin = lwr, ymax = upr), alpha = 0.25)</code>
(the <code>alpha</code> here is for transparency), together with the
observed data. It can be useful to join the predictions and data into a
new data.frame object to get access to both the prediction information
and data when plotting.</p>
<!--



Here, the `geom_point` call gets its own `data` input to ensure each data point is
only plotted once.
-->
</div>
</div>
<div class="section level2">
<h2 id="prediction-scores">Prediction Scores<a class="anchor" aria-label="anchor" href="#prediction-scores"></a>
</h2>
<p>Now, use the score calculator function <code><a href="../reference/proper_score.html">proper_score()</a></code>
from the StatCompLab package to compute the squared error,
Dawid-Sebastiani, and Interval scores (with target coverage probability
90%). It’s useful to joint the prediction information and data set with
<code>cbind</code>, so that e.g. <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> can have access
to all the needed information.</p>
<!--


See the next section for a more compact alternative (first combining the prediction information from both models, and
then computing all the scores in one go).
-->
<p>As a basic summary of the results, compute the average score
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>S</mi><mo accent="true">¯</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>F</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\overline{S}(\{F_i,y_i\})</annotation></semantics></math>
for each model and type of score, and present the result with
<code><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">knitr::kable()</a></code>.</p>
<!--


-->
<p>Do the scores indicate that one of the models is better or worse than
the other? Do the three score types agree with each other?</p>
<!--

The squared error score doesn't really care about the difference between the two models,
since it doesn't directly involve the variance model (the paramter estimates for the mean are different, but not by much). The other two scores indicate that model B is better than model A.
-->
</div>
<div class="section level2">
<h2 id="data-splitting">Data splitting<a class="anchor" aria-label="anchor" href="#data-splitting"></a>
</h2>
<p>Now, use the <code><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample()</a></code> function to generate a random
selection of the rows of the data set, and split it into two parts, with
ca 50% to be used for parameter estimation, and 50% to be used for
prediction assessment.</p>
<!--


-->
<p>Redo the previous analysis for the problem using this division of the
data.</p>
<!--


-->
<p>Do the score results agree with the previous results?</p>
<!--

The results will have some more random variability due to the smaller size of the estimation and prediction sets, but will likely agree with the previous results.
-->
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
