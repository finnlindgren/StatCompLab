<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="StatCompLab">
<title>StatComp Project Example Solution: Numerical Statistics • StatCompLab</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="StatComp Project Example Solution: Numerical Statistics">
<meta property="og:description" content="StatCompLab">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">StatCompLab</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">23.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Project01.html">StatComp Project 1 (2022/23): Simulation and sampling</a>
    <a class="dropdown-item" href="../articles/Project01Hints.html">StatComp Project 1 (2022/23): Hints</a>
    <a class="dropdown-item" href="../articles/Project02.html">StatComp Project 2: Scottish weather</a>
    <a class="dropdown-item" href="../articles/Project02Hints.html">StatComp Project 2 (2022/23): Hints</a>
    <a class="dropdown-item" href="../articles/Tutorial01.html">Tutorial 01: R and linear models</a>
    <a class="dropdown-item" href="../articles/Tutorial01Solutions.html">Tutorial 01: R and linear models (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial02.html">Tutorial 02: Optimization</a>
    <a class="dropdown-item" href="../articles/Tutorial02Solutions.html">Tutorial 02: Optimization (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial03.html">Tutorial 03: Monte Carlo integration</a>
    <a class="dropdown-item" href="../articles/Tutorial03Solutions.html">Tutorial 03: Monte Carlo integration (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial04.html">Tutorial 04: Uncertainty and integration</a>
    <a class="dropdown-item" href="../articles/Tutorial04Solutions.html">Tutorial 04: Uncertainty and integration (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial06.html">Tutorial 06: Prediction assessment with proper scores</a>
    <a class="dropdown-item" href="../articles/Tutorial06Solutions.html">Tutorial 06: Prediction assessment with proper scores (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial07.html">Tutorial 07: Data wrangling and cross validation</a>
    <a class="dropdown-item" href="../articles/Tutorial07Solutions.html">Tutorial 07: Data wrangling and cross validation (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial08.html">Tutorial 08: Floating point computations and least squares</a>
    <a class="dropdown-item" href="../articles/Tutorial08Solutions.html">Tutorial 08: Floating point computations and least squares (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial09.html">Tutorial 09: Bootstrap and Pareto smoothed importance sampling</a>
    <a class="dropdown-item" href="../articles/Tutorial09Solutions.html">Tutorial 09: Bootstrap and Pareto smoothed importance sampling (solutions)</a>
    <a class="dropdown-item" href="../articles/Project_Example.html">StatComp Project Example: Numerical statistics</a>
    <a class="dropdown-item" href="../articles/Project_Example_Solution.html">StatComp Project Example Solution: Numerical Statistics</a>
    <a class="dropdown-item" href="../articles/Quiz1Solution.html">Quiz 1 Solution (StatComp 2021/22)</a>
    <a class="dropdown-item" href="../articles/T4sol.html">Tutorial 04: Uncertainty and integration (full solution)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/finnlindgren/StatCompLab/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>StatComp Project Example Solution: Numerical Statistics</h1>
                        <h4 data-toc-skip class="author">Finn Lindgren
(s0000000, finnlindgren)</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/finnlindgren/StatCompLab/blob/HEAD/vignettes/articles/Project_Example_Solution.Rmd" class="external-link"><code>vignettes/articles/Project_Example_Solution.Rmd</code></a></small>
      <div class="d-none name"><code>Project_Example_Solution.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="archaeology-in-the-baltic-sea">Archaeology in the Baltic sea<a class="anchor" aria-label="anchor" href="#archaeology-in-the-baltic-sea"></a>
</h2>
<p>Pairs of counts <span class="math inline">\((Y_{j,1},Y_{j,2})\)</span> of left and right
femurs from archaeological excavations are modelled as being
conditionally independent realisations from <span class="math inline">\(\textrm{Binom}(N_j,\phi)\)</span>, where <span class="math inline">\(N_j\)</span> is the original number of people
buried at each excavtion site, and <span class="math inline">\(\phi\)</span> is the probability of finding a
buried femur. The prior distribution for each <span class="math inline">\(N_j\)</span>, <span class="math inline">\(j=1,\dots,J\)</span>, is <span class="math inline">\(\textrm{Geom}(\xi)\)</span>, where <span class="math inline">\(\xi=1/(1+1000)\)</span> (so that <span class="math inline">\(\textrm{E}(N_j)=1000\)</span> <em>a priori</em>),
and for the detection probability, <span class="math inline">\(\phi\sim\textrm{Beta}(\frac{1}{2},\frac{1}{2})\)</span>.
We denote <span class="math inline">\(\boldsymbol{N}=\{N_1,\dots,N_J\}\)</span> and
<span class="math inline">\(\boldsymbol{Y}=\{(Y_{1,1},Y_{1,2}),\dots,(Y_{J,1},Y_{J,2})\}\)</span>.</p>
<div class="section level3">
<h3 id="joint-probability-function">Joint probability function<a class="anchor" aria-label="anchor" href="#joint-probability-function"></a>
</h3>
<p>Taking the product of the prior density for <span class="math inline">\(\phi\)</span>, the prior probabilities for <span class="math inline">\(N_j\)</span>, and the conditional observation
probabilities for <span class="math inline">\(N_{j,i}\)</span> and
integrating over <span class="math inline">\(\phi\)</span>, we get the
joint probability function for <span class="math inline">\((\boldsymbol{N},\boldsymbol{Y})\)</span> <span class="math display">\[
\begin{aligned}
\textrm{P}(\boldsymbol{N},\boldsymbol{Y})
&amp;= \int_0^1 p_\phi(\phi) \prod_{j=1}^J p(N_j) \prod_{i=1}^2
p(Y_{j,i}|N_j,\phi)\,\mathrm{d}\phi \\
&amp;= \int_0^1 \frac{\phi^{a-1}(1-\phi)^{b-1}}{B(a,b)}
  \prod_{j=1}^J p(N_j) \prod_{i=1}^2 {N_j \choose Y_{j,i}}
\phi^{Y_{j,i}}(1-\phi)^{N_j-Y_{j,i}}
  \,\mathrm{d}\phi \\
&amp;= \int_0^1
\frac{\phi^{\widetilde{a}-1}(1-\phi)^{\widetilde{b}-1}}{B(a,b)}
\,\mathrm{d}\phi\,
  \prod_{j=1}^J p(N_j) \prod_{i=1}^2 {N_j \choose Y_{j,i}} ,
\end{aligned}
\]</span> where <span class="math inline">\(\widetilde{a} =
a+\sum_{j=1}^J\sum_{i=1}^2 Y_{j,i}\)</span> and <span class="math inline">\(\widetilde{b} = b+\sum_{j=1}^J\sum_{i=1}^2 (N_j -
Y_{j,i})\)</span>. Then the integral can be renormalised to an integral
of the distribution probability density function for a <span class="math inline">\(\textrm{Beta}(\widetilde{a},\widetilde{b})\)</span>
distribution: <span class="math display">\[
\begin{aligned}
\textrm{P}(\boldsymbol{N},\boldsymbol{Y})
&amp;= \frac{B(\widetilde{a},\widetilde{b})}{B(a,b)}
  \int_0^1
\frac{\phi^{\widetilde{a}-1}(1-\phi)^{\widetilde{b}-1}}{B(\widetilde{a},\widetilde{b})}
  \,\mathrm{d}\phi\,
  \prod_{j=1}^J p(N_j) \prod_{i=1}^2 {N_j \choose Y_{j,i}} \\
&amp;= \frac{B(\widetilde{a},\widetilde{b})}{B(a,b)}
  \prod_{j=1}^J p(N_j) \prod_{i=1}^2 {N_j \choose Y_{j,i}} .
\end{aligned}
\]</span></p>
</div>
<div class="section level3">
<h3 id="credible-intervals-for-n_j-and-phi">Credible intervals for <span class="math inline">\(N_j\)</span> and
<span class="math inline">\(\phi\)</span><a class="anchor" aria-label="anchor" href="#credible-intervals-for-n_j-and-phi"></a>
</h3>
<p>In order to obtain posterior credible intervals for the unknown
quantities <span class="math inline">\(\boldsymbol{N}=\{N_1,\dots,N_J\}\)</span>, and
<span class="math inline">\(\phi\)</span>, we implement an importance
sampling method that sample each <span class="math inline">\(N_j\)</span> from a shifted Geometric distribution
with smallest value equal to the smallest valid <span class="math inline">\(N_j\)</span>, given the observed counts, and
expectation corresponding to <span class="math inline">\(\phi=1/4\)</span>. After sampling the <span class="math inline">\(\boldsymbol{N}\)</span> values, the corresponding
importance weights <span class="math inline">\(w_k\)</span>, stored as
<code>Log_Weights</code> equal to <span class="math inline">\(\log(w_k)\)</span> normalised by subtracting the
larges <span class="math inline">\(\log(w_k)\)</span> value. Finally,
<span class="math inline">\(\phi\)</span> values are sampled directly
from the conditional posterior distribution <span class="math inline">\((\phi|\boldsymbol{N},\boldsymbol{Y})\sim\textrm{Beta}\left(\frac{1}{2}+\sum_{j,i}
Y_{i,j},\frac{1}{2}+\sum_{j,i} (N_j-Y_{i,j})\right)\)</span>. The
implementation is in the <code>arch_importance()</code> function in
<code>my_code.R</code> shown in the code appendix, and produces an
importance sample of size <span class="math inline">\(K\)</span>. To
achieve relatively reliable results, we use <span class="math inline">\(K=100000\)</span>, for each of <span class="math inline">\(J=1\)</span>, <span class="math inline">\(2\)</span>, <span class="math inline">\(3\)</span>, and <span class="math inline">\(4\)</span>, which takes ca 4 seconds on my
computer.</p>
<p>First, we use <code>stat_ewcdf</code> to plot the emprirical
cumulative distribution functions for the importance weighted posterior
samples of <span class="math inline">\(N_1\)</span>, for <span class="math inline">\(J=1,\dots,4\)</span>. We can see that the random
variability increases for larger <span class="math inline">\(J\)</span>,
indicating a lower efficiency of the importance sampler. Also included
is the CDF for the prior distribution for <span class="math inline">\(N_1\)</span>. Except for the lower end of the
distribution, it’s not immediately clear what effect the observations
have on the distribution.</p>
<p><img src="Project_Example_Solution_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Next we do a corresponding plot for <span class="math inline">\(\phi\)</span>. In contrast to <span class="math inline">\(N_1\)</span>, here it’s more clear that the more
observation pairs we get, the more concentrated the distribution for
<span class="math inline">\(\phi\)</span> gets. Each new observation
pair also influences in particular the lower end of the distribution,
with the lower quantiles clearly increasing for <span class="math inline">\(J=4\)</span> even though the upper quantiles
remain relatively stable for <span class="math inline">\(J\geq
2\)</span>.</p>
<p><img src="Project_Example_Solution_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Using <code>wquantile</code> to extract lower and upper <span class="math inline">\(5\%\)</span> quantiles we obtain approximate <span class="math inline">\(90\%\)</span> posterior credible intervals for
<span class="math inline">\(N_1\)</span> and <span class="math inline">\(\phi\)</span> as shown in the following table.</p>
<table class="table">
<thead><tr class="header">
<th align="right">J</th>
<th align="left">Variable</th>
<th align="right">Lower</th>
<th align="right">Upper</th>
<th align="right">Width</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">N1</td>
<td align="right">313.0000000</td>
<td align="right">2458.0000000</td>
<td align="right">2145.0000000</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">N1</td>
<td align="right">370.0000000</td>
<td align="right">3454.0000000</td>
<td align="right">3084.0000000</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">N1</td>
<td align="right">421.0000000</td>
<td align="right">3622.0000000</td>
<td align="right">3201.0000000</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">N1</td>
<td align="right">382.0000000</td>
<td align="right">2023.0000000</td>
<td align="right">1641.0000000</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Phi</td>
<td align="right">0.1000917</td>
<td align="right">0.7881835</td>
<td align="right">0.6880917</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Phi</td>
<td align="right">0.0710623</td>
<td align="right">0.6668649</td>
<td align="right">0.5958026</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Phi</td>
<td align="right">0.0680256</td>
<td align="right">0.5849711</td>
<td align="right">0.5169454</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Phi</td>
<td align="right">0.1223360</td>
<td align="right">0.6525176</td>
<td align="right">0.5301816</td>
</tr>
</tbody>
</table>
<p>We can see that the credible intervals for <span class="math inline">\(N_1\)</span> are strongly linked to the
information in the posterior distribution for <span class="math inline">\(\phi\)</span>. Interestingly, due to the lowering
of the lower endpoint for <span class="math inline">\(\phi\)</span> for
<span class="math inline">\(J=2\)</span> and <span class="math inline">\(3\)</span>, the width of the <span class="math inline">\(N_1\)</span> interval actually <em>increases</em>
when we add the information from the second and third. This is stark
contrast to our common intuition that would expect our uncertainty to
decrease when we collect more data. The behaviour here is partly due to
the random variability inherent in a small sample, but also due to the
strong non-linearity of the estimation problem, where the products <span class="math inline">\(\phi N_j\)</span> are much easier to estimate than
the individual <span class="math inline">\(\phi\)</span> and <span class="math inline">\(N_j\)</span> parameters. For <span class="math inline">\(J=4\)</span>, the interval width for <span class="math inline">\(N_1\)</span> finally decreases, as well as the
width for the <span class="math inline">\(\phi\)</span> interval.
Looking at the values of the observations, we can see that the <span class="math inline">\(J=4\)</span> case has much larger values than the
other cases, which leads to it providing relatively more information
about the <span class="math inline">\(\phi\)</span> parameter.</p>
<p>From a practical point of view, it’s clear that this estimation
problem does not have an easy solution. Even with multiple excavations,
and assuming that the model is appropriate and has the same value <span class="math inline">\(\phi\)</span> for <span class="math inline">\(\phi\)</span> for every excavation, we only gain a
modest amount of additional information. On the positive side, if the
model does a good job of approximating reality, then borrowing strength
across multiple excavations does improve the estimates and uncertainty
information for each excavation. For further improvements, one would
likely need to more closely study the excavation precedures, to gain a
better understanding of this data generating process, which might then
lead to improved statistical methods and archaeologically relevant
outcomes.</p>
</div>
<div class="section level3">
<h3 id="extra">Extra<a class="anchor" aria-label="anchor" href="#extra"></a>
</h3>
<div class="section level4">
<h4 id="effective-sample-size">Effective sample size<a class="anchor" aria-label="anchor" href="#effective-sample-size"></a>
</h4>
<p>Using the method for computing effective importance sample size from
later in the course we can see that even with the more efficient method,
the sampling is very inefficient for <span class="math inline">\(J=4\)</span>, indicating that an improved choice
of importance distribution for <span class="math inline">\(N_j\)</span>
could improve the precision and accuracy of the results:</p>
<table class="table">
<thead><tr class="header">
<th align="right">J</th>
<th align="right">EffSampleSize</th>
<th align="right">RelEff</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">827101.3317</td>
<td align="right">0.8271013</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">123325.1049</td>
<td align="right">0.1233251</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">5652.0431</td>
<td align="right">0.0056520</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">645.0274</td>
<td align="right">0.0006450</td>
</tr>
</tbody>
</table>
<p>Here, <code>EffSampleSize</code> is the approximate effective sample
size <span class="math inline">\((\sum_k w_k)^2/\sum w_k^2\)</span>, and
<code>RelEff</code> is the relative efficiency, defined as the ratio
between <code>EffSampleSize</code> and <span class="math inline">\(K=100000\)</span>.</p>
</div>
<div class="section level4">
<h4 id="profile-likelihood-method-for-frequentist-confidence-interval-for-textrmbinomnp">Profile likelihood method for frequentist confidence interval for
<span class="math inline">\(\textrm{Binom}(n,p)\)</span><a class="anchor" aria-label="anchor" href="#profile-likelihood-method-for-frequentist-confidence-interval-for-textrmbinomnp"></a>
</h4>
<p><img src="Project_Example_Solution_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<pre><code><span><span class="co">## [1] 274</span></span></code></pre>
<p>(actually <code>range(y)</code> depends on <code>n</code> may mean
<code>l0</code> not justified for this example)</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="code-appendix">Code appendix<a class="anchor" aria-label="anchor" href="#code-appendix"></a>
</h2>
<div class="section level3">
<h3 id="function-definitions">Function definitions<a class="anchor" aria-label="anchor" href="#function-definitions"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Finn Lindgren (s0000000, finnlindgren)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Joint log-probability</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Usage:</span></span>
<span><span class="co">#   log_prob_NY(N, Y, xi, a, b)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Calculates the joint probability for N and Y, when</span></span>
<span><span class="co">#   N_j ~ Geom(xi)</span></span>
<span><span class="co">#   phi ~ Beta(a, b)</span></span>
<span><span class="co">#   Y_{ji} ~ Binom(N_j, phi)</span></span>
<span><span class="co">#   For j = 1,...,J</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Inputs:</span></span>
<span><span class="co">#   N: vector of length J</span></span>
<span><span class="co">#   Y: data.frame or matrix of dimension Jx2</span></span>
<span><span class="co">#   xi: The probability parameter for the N_j priors</span></span>
<span><span class="co">#   a, b: the parameters for the phi-prior</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Output:</span></span>
<span><span class="co">#   The log of the joint probability for N and Y</span></span>
<span><span class="co">#   For impossible N,Y combinations, returns -Inf</span></span>
<span></span>
<span><span class="va">log_prob_NY</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">Y</span>, <span class="va">xi</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Convert Y to a matrix to allow more vectorised calculations:</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">N</span> <span class="op">&lt;</span> <span class="va">Y</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">atilde</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span>  <span class="va">btilde</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="co"># Note: b + sum(N - Y) would be more general</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lbeta</a></span><span class="op">(</span><span class="va">atilde</span>, <span class="va">btilde</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lbeta</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">dgeom</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">xi</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lchoose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Importance sampling for N,phi conditionally on Y</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Usage:</span></span>
<span><span class="co">#   arch_importance(K,Y,xi,a,b)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Inputs:</span></span>
<span><span class="co">#   Y,xi,a,b have the same meaning and syntax as for log_prob_NY(N,Y,xi,a,b)</span></span>
<span><span class="co">#   The argument K defines the number of samples to generate.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Output:</span></span>
<span><span class="co">#  A data frame with K rows and J+1 columns, named N1, N2, etc,</span></span>
<span><span class="co">#  for each j=1,…,J, containing samples from an importance sampling</span></span>
<span><span class="co">#  distribution for Nj,</span></span>
<span><span class="co">#  a column Phi with sampled phi-values,</span></span>
<span><span class="co">#  and a final column called Log_Weights, containing re-normalised</span></span>
<span><span class="co">#  log-importance-weights, constructed by shifting log(w[k]) by subtracting the</span></span>
<span><span class="co">#  largest log(w[k]) value, as in lab 4.</span></span>
<span></span>
<span><span class="va">arch_importance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>, <span class="va">Y</span>, <span class="va">xi</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span>  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span>  <span class="va">N_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">Y</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span>, <span class="va">K</span>, <span class="va">J</span><span class="op">)</span></span>
<span>  <span class="va">xi_sample</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">N_sample</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">rgeom</a></span><span class="op">(</span><span class="va">K</span> <span class="op">*</span> <span class="va">J</span>, prob <span class="op">=</span> <span class="va">xi_sample</span><span class="op">)</span>, <span class="va">K</span>, <span class="va">J</span><span class="op">)</span> <span class="op">+</span> <span class="va">N_sample</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Log_Weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="fu">log_prob_NY</span><span class="op">(</span><span class="va">N</span><span class="op">[</span><span class="va">k</span>, , drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>, <span class="va">Y</span>, <span class="va">xi</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>,</span>
<span>    <span class="fl">0.0</span><span class="op">)</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">dgeom</a></span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">N_sample</span>, prob <span class="op">=</span> <span class="va">xi_sample</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">phi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">K</span>, <span class="va">a</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, <span class="va">b</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>        Phi <span class="op">=</span> <span class="va">phi</span>,</span>
<span>        Log_Weights <span class="op">=</span> <span class="va">Log_Weights</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analysis-code">Analysis code<a class="anchor" aria-label="anchor" href="#analysis-code"></a>
</h3>
<div class="section level4">
<h4 id="confidence-intervals">Confidence intervals<a class="anchor" aria-label="anchor" href="#confidence-intervals"></a>
</h4>
<p>Poisson parameter interval simulations:</p>
<p>Summarise the coverage probabilities and interval widths:</p>
<p>Plot the CDFs for the CI width distributions:</p>
</div>
<div class="section level4">
<h4 id="archaeology">Archaeology<a class="anchor" aria-label="anchor" href="#archaeology"></a>
</h4>
<p>Compute credible intervals for <span class="math inline">\(N_j\)</span> for different amounts of data, <span class="math inline">\(J\)</span>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xi</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">1001</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">1000000</span></span>
<span><span class="va">NW1</span> <span class="op">&lt;-</span> <span class="fu">arch_importance</span><span class="op">(</span><span class="va">K</span>, <span class="fu">arch_data</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="va">xi</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="va">NW2</span> <span class="op">&lt;-</span> <span class="fu">arch_importance</span><span class="op">(</span><span class="va">K</span>, <span class="fu">arch_data</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="va">xi</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="va">NW3</span> <span class="op">&lt;-</span> <span class="fu">arch_importance</span><span class="op">(</span><span class="va">K</span>, <span class="fu">arch_data</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, <span class="va">xi</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="va">NW4</span> <span class="op">&lt;-</span> <span class="fu">arch_importance</span><span class="op">(</span><span class="va">K</span>, <span class="fu">arch_data</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="va">xi</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span></code></pre></div>
<p>For completeness, we compute all the credible intervals for <span class="math inline">\(N_j\)</span>, <span class="math inline">\(1\leq
J\)</span>, for each <span class="math inline">\(J=1,\dots,4\)</span>,
but the analysis focuses on <span class="math inline">\(N_1\)</span> and
<span class="math inline">\(\phi\)</span>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">NW1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>      J <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      End <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lower"</span>, <span class="st">"Upper"</span><span class="op">)</span>,</span>
<span>      N1 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N1</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N2 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      N3 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      N4 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      Phi <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">Phi</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">7</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="va">NW2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>      J <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      End <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lower"</span>, <span class="st">"Upper"</span><span class="op">)</span>,</span>
<span>      N1 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N1</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N2 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N2</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N3 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      N4 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      Phi <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">Phi</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">7</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="va">NW3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>      J <span class="op">=</span> <span class="fl">3</span>,</span>
<span>      End <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lower"</span>, <span class="st">"Upper"</span><span class="op">)</span>,</span>
<span>      N1 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N1</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N2 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N2</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N3 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N3</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N4 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      Phi <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">Phi</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">7</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="va">NW4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>      J <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      End <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lower"</span>, <span class="st">"Upper"</span><span class="op">)</span>,</span>
<span>      N1 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N1</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N2 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N2</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N3 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N3</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      N4 <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">N4</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      Phi <span class="op">=</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">Phi</span>,</span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        type <span class="op">=</span> <span class="fl">7</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Log_Weights</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Restructure the interval <code>data.frame</code> to focus on <span class="math inline">\(N_1\)</span> and <span class="math inline">\(\phi\)</span> only:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CI_</span> <span class="op">&lt;-</span> <span class="va">CI</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">N1</span>, <span class="va">N2</span>, <span class="va">N3</span>, <span class="va">N4</span>, <span class="va">Phi</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"Variable"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">End</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Lower</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Width <span class="op">=</span> <span class="va">Upper</span> <span class="op">-</span> <span class="va">Lower</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">CI_</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N1"</span>, <span class="st">"Phi"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Variable</span>, <span class="va">J</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
