<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial 06: Prediction assessment with proper scores (solutions) • StatCompLab</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial 06: Prediction assessment with proper scores (solutions)">
<meta property="og:description" content="Statistical Computing: Lab tutorial 6">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">StatCompLab</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lab01.html">Lab01</a>
    </li>
    <li>
      <a href="../articles/Lab02.html">Lab02</a>
    </li>
    <li>
      <a href="../articles/Lab03.html">Lab03</a>
    </li>
    <li>
      <a href="../articles/Project01.html">StatComp Project 1 (2020/21): Numerical statistics</a>
    </li>
    <li>
      <a href="../articles/Project01Hints.html">Project 01 Hints</a>
    </li>
    <li>
      <a href="../articles/Tutorial01.html">Tutorial 01: R and linear models</a>
    </li>
    <li>
      <a href="../articles/Tutorial01Solutions.html">Tutorial 01: R and linear models (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial03.html">Tutorial 03: Monte Carlo integration</a>
    </li>
    <li>
      <a href="../articles/Tutorial03Solutions.html">Tutorial 03: Monte Carlo integration (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial04.html">Tutorial 04: Uncertainty and integration</a>
    </li>
    <li>
      <a href="../articles/Tutorial04Solutions.html">Tutorial 04: Uncertainty and integration (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial06.html">Tutorial 06: Prediction assessment with proper scores</a>
    </li>
    <li>
      <a href="../articles/Tutorial06Solutions.html">Tutorial 06: Prediction assessment with proper scores (solutions)</a>
    </li>
    <li>
      <a href="../articles/Tutorial07.html">Tutorial 07: Data wrangling and cross validation</a>
    </li>
    <li>
      <a href="../articles/Tutorial07Solutions.html">Tutorial 07: Data wrangling and cross validation (solutions)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/finnlindgren/StatCompLab/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Tutorial06Solutions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial 06: Prediction assessment with proper scores (solutions)</h1>
                        <h4 class="author">Finn Lindgren</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/finnlindgren/StatCompLab/blob/master/vignettes/Tutorial06Solutions.Rmd"><code>vignettes/Tutorial06Solutions.Rmd</code></a></small>
      <div class="hidden name"><code>Tutorial06Solutions.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this lab session you will explore</p>
<ul>
<li>Probabilistic prediction and proper scores</li>
</ul>
<ol style="list-style-type: decimal">
<li>Open your github repository clone project from Lab 2 (either on <a href="https://rstudio.cloud">https://rstudio.cloud</a> or on your own computer and upgrade the <code>StatCompLab</code> package (see the <code>Lab03</code> vignette for more details)</li>
<li>During this lab, you can either work in a <code>.R</code> file or a new <code>.Rmd</code> file.</li>
</ol>
<!--

The accompanying `Tutorial06Solutions` tutorial/vignette documents contain the
solutions explicitly, to make it easier to review the material after the workshops.
-->
</div>
<div id="d-printer" class="section level2">
<h2 class="hasAnchor">
<a href="#d-printer" class="anchor"></a>3D printer</h2>
<p>The aim is to build and assess statistical models of material use in a 3D printer.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> The printer uses rolls of <em>filament</em> that gets heated and squeezed through a moving nozzle, gradually building objects. The objects are first designed in a CAD program (Computer Aided Design), that also estimates how much material will be required to print the object.</p>
<p>The data can be loaded with <code><a href="https://rdrr.io/r/utils/data.html">data("filament1", package = "StatCompLab")</a></code>, and contains information about one 3D-printed object per row. The columns are</p>
<ul>
<li>
<code>Index</code>: an observation index</li>
<li>
<code>Date</code>: printing dates</li>
<li>
<code>Material</code>: the printing material, identified by its colour</li>
<li>
<code>CAD_Weight</code>: the object weight (in gram) that the CAD software calculated</li>
<li>
<code>Actual_Weight</code>: the actual weight of the object (in gram) after printing</li>
</ul>
<p>If the CAD system and printer were both perfect, the <code>CAD_Weight</code> and <code>Actual_Weight</code> values would be equal for each object. In reality, there is both random variation, for example due to varying humidity and temperature, and systematic deviations due to the CAD system not having perfect information about the properties of the printing materials.</p>
<p>When looking at the data (see below) it’s clear that the variability of the data is larger for larger values of <code>CAD_Weight</code>. The printer operator wants to know which of two models, named A and B, are better at capturing the distributions of the random deviations.</p>
<p>Both models use a linear model for coneection between <code>CAD_Weight</code> and <code>Actual_Weight</code>. We denote the CAD weight for observations <span class="math inline">\(i\)</span> by <code>x_i</code>, and the corresponding actual weight by <span class="math inline">\(y_i\)</span>. The two models are defined by</p>
<ul>
<li>Model A: <span class="math inline">\(y_i \sim \mathsf{Normal}[\theta_1 + \theta_2 x_i, \exp(\theta_3 + \theta_4 x_i)]\)</span>
</li>
<li>Model B: <span class="math inline">\(y_i \sim \mathsf{Normal}[\theta_1 + \theta_2 x_i, \exp(\theta_3) + \exp(\theta_4) x_i^2)]\)</span>
</li>
</ul>
<p>The printer operator reasons that due to random fluctuations in the material properties (such as the density) and room temperature should lead to a <em>relative</em> error instead of an additive error, and this leads them to model B as an approximation of that. The basic physics assumption is that the error in the CAD software calculation of the weight is proportional to the weight itself. Model A on the other hand is slightly more mathematically convenient, but has no such motivation in physics.</p>
<p>Start by loading the data and plot it.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"filament1"</span>, package <span class="op">=</span> <span class="st">"StatCompLab"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">filament1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">CAD_Weight</span>, <span class="va">Actual_Weight</span>, colour <span class="op">=</span> <span class="va">Material</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial06Solutions_files/figure-html/load-data-show-1.png" width="576"></p>
<hr>
</div>
<div id="estimate-and-predict" class="section level2">
<h2 class="hasAnchor">
<a href="#estimate-and-predict" class="anchor"></a>Estimate and predict</h2>
<p>Next week, we will assess model predictions using cross validation, where data is split into separate parts for parameter estimation and prediction assessment, in order to avoid or reduce bias in the prediction assessments. For simplicity this week, we will start by using the entire data set for both parameter estimation and prediction assessment.</p>
<div id="estimate" class="section level3">
<h3 class="hasAnchor">
<a href="#estimate" class="anchor"></a>Estimate</h3>
<p>First, use <code>filament1_estimate</code> from the <code>StatCompLab</code> package to estimate the two models A and B using the <code>filament1</code> data. See the help text for information.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_estimate.html">filament1_estimate</a></span><span class="op">(</span><span class="va">filament1</span>, <span class="st">"A"</span><span class="op">)</span>
<span class="va">fit_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_estimate.html">filament1_estimate</a></span><span class="op">(</span><span class="va">filament1</span>, <span class="st">"B"</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div id="prediction" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction" class="anchor"></a>Prediction</h3>
<p>Next, use <code><a href="../reference/filament1_predict.html">filament1_predict()</a></code> to compute probabilistic predictions of <code>Actual_Weight</code> using the two estimated models.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_predict.html">filament1_predict</a></span><span class="op">(</span><span class="va">fit_A</span>, newdata <span class="op">=</span> <span class="va">filament1</span><span class="op">)</span>
<span class="va">pred_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_predict.html">filament1_predict</a></span><span class="op">(</span><span class="va">fit_B</span>, newdata <span class="op">=</span> <span class="va">filament1</span><span class="op">)</span></code></pre></div>
<hr>
<p>Inspect the predictions by drawing figures, e.g. with <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon(aes(CAD_Weight, ymin = lwr, ymax = upr), alpha = 0.25)</a></code> (the <code>alpha</code> here is for transparency), together with the observed data. It can be useful to join the predictions and data into new data.frame objects to get access to both the prediction information and data when plotting.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">CAD_Weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean</span>, col <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_A</span>, <span class="va">filament1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean</span>, col <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_B</span>, <span class="va">filament1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span>, fill <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,
              data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_A</span>, <span class="va">filament1</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span>, fill <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>,
              data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_B</span>, <span class="va">filament1</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Actual_Weight</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">filament1</span><span class="op">)</span></code></pre></div>
<p><img src="Tutorial06Solutions_files/figure-html/predplot-show-1.png" width="576"></p>
<p>A more compact alternative is to first collect all the data into a common data object, using the techniques introduced in the later sections of this lab:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_A</span>, <span class="va">filament1</span>, model <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_B</span>, <span class="va">filament1</span>, model <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,
       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">CAD_Weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean</span>, col <span class="op">=</span> <span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span>, fill <span class="op">=</span> <span class="va">model</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Actual_Weight</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">filament1</span><span class="op">)</span></code></pre></div>
<p>Here, the <code>geom_point</code> call gets its own <code>data</code> input to ensure each data point is only plotted once.</p>
<hr>
</div>
</div>
<div id="prediction-scores" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction-scores" class="anchor"></a>Prediction Scores</h2>
<p>Now, use the score calculator function <code>proper_score</code> from the StatCompLab package to compute the squared error, Dawid-Sebastiani, and Interval scores (with target coverage probability 90%). It’s useful to joint the prediction information and data set with <code>cbind</code>, so that e.g. <code>mutate()</code> can have access to all the needed information.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">score_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_A</span>, <span class="va">filament1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    se <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"se"</span>, <span class="va">Actual_Weight</span>, mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>,
    ds <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"ds"</span>, <span class="va">Actual_Weight</span>, mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span>,
    interval <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"interval"</span>, <span class="va">Actual_Weight</span>,
                            lwr <span class="op">=</span> <span class="va">lwr</span>, upr <span class="op">=</span> <span class="va">upr</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">score_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_B</span>, <span class="va">filament1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    se <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"se"</span>, <span class="va">Actual_Weight</span>, mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>,
    ds <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"ds"</span>, <span class="va">Actual_Weight</span>, mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span>,
    interval <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"interval"</span>, <span class="va">Actual_Weight</span>,
                            lwr <span class="op">=</span> <span class="va">lwr</span>, upr <span class="op">=</span> <span class="va">upr</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>See the next section for a more compact alternative.</p>
<hr>
<p>As a basic summary of the results, compute the average score <span class="math inline">\(\overline{S}(\{F_i,y_i\})\)</span> for each model and type of score, and present the result with <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">knitr::kable()</a></code>.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">score_AB</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">score_A</span>, model <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">score_B</span>, model <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">%&gt;%</span>
          <span class="fu">summarise</span><span class="op">(</span>se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span>,
                    ds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span>,
                    interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">interval</span><span class="op">)</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">score_AB</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">model</th>
<th align="right">se</th>
<th align="right">ds</th>
<th align="right">interval</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="right">1.783616</td>
<td align="right">1.0428110</td>
<td align="right">5.471989</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="right">1.790706</td>
<td align="right">0.8874053</td>
<td align="right">5.108026</td>
</tr>
</tbody>
</table>
<hr>
<p>Do the scores indicate that one of the models is better or worse than the other? Do the three score types agree with each other?</p>
<hr>
<p><strong>Solution:</strong></p>
<p>The squared error score doesn’t really care about the difference between the two models, since it doesn’t directly involve the variance model (the paramter estimates for the mean are different, but not by much). The other two scores indicate that model B is better than model A.</p>
<hr>
</div>
<div id="data-splitting" class="section level2">
<h2 class="hasAnchor">
<a href="#data-splitting" class="anchor"></a>Data splitting</h2>
<p>Now, use the <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function to generate a random selection of the rows of the data set, and split it into two parts, with ca 50% to be used for parameter estimation, and 50% to be used for prediction assessment.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">idx_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">filament1</span><span class="op">$</span><span class="va">Index</span>,
                  size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">filament1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">)</span>,
                  replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">filament1_est</span> <span class="op">&lt;-</span> <span class="va">filament1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Index</span> <span class="op">%in%</span> <span class="va">idx_est</span><span class="op">)</span>
<span class="va">filament1_pred</span> <span class="op">&lt;-</span> <span class="va">filament1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">Index</span> <span class="op">%in%</span> <span class="va">idx_est</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<hr>
<p>Redo the previous analysis for the problem using this division of the data.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_estimate.html">filament1_estimate</a></span><span class="op">(</span><span class="va">filament1_est</span>, <span class="st">"A"</span><span class="op">)</span>
<span class="va">fit_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_estimate.html">filament1_estimate</a></span><span class="op">(</span><span class="va">filament1_est</span>, <span class="st">"B"</span><span class="op">)</span>
<span class="va">pred_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_predict.html">filament1_predict</a></span><span class="op">(</span><span class="va">fit_A</span>, newdata <span class="op">=</span> <span class="va">filament1_pred</span><span class="op">)</span>
<span class="va">pred_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filament1_predict.html">filament1_predict</a></span><span class="op">(</span><span class="va">fit_B</span>, newdata <span class="op">=</span> <span class="va">filament1_pred</span><span class="op">)</span>
<span class="va">scores</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_A</span>, <span class="va">filament1_pred</span>, model <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pred_B</span>, <span class="va">filament1_pred</span>, model <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    se <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"se"</span>, <span class="va">Actual_Weight</span>, mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>,
    ds <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"ds"</span>, <span class="va">Actual_Weight</span>, mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span>,
    interval <span class="op">=</span> <span class="fu"><a href="../reference/proper_score.html">proper_score</a></span><span class="op">(</span><span class="st">"interval"</span>, <span class="va">Actual_Weight</span>,
                            lwr <span class="op">=</span> <span class="va">lwr</span>, upr <span class="op">=</span> <span class="va">upr</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">score_summary</span> <span class="op">&lt;-</span> <span class="va">scores</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span>,
            ds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span>,
            interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">interval</span><span class="op">)</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">score_summary</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">model</th>
<th align="right">se</th>
<th align="right">ds</th>
<th align="right">interval</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="right">2.347716</td>
<td align="right">1.526730</td>
<td align="right">5.644020</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="right">2.561198</td>
<td align="right">1.215711</td>
<td align="right">4.878368</td>
</tr>
</tbody>
</table>
<hr>
<p>Do the score results agree with the previous results?</p>
<hr>
<p><strong>Solution:</strong></p>
<p>The results will have some more random variability due to the smaller size of the estimation and prediction sets, but will likely agree with the previous results.</p>
<hr>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Special thanks to Sten Lindgren for providing the printer data.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
