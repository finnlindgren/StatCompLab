<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Statistical Computing: Lab tutorial 4">
<title>Tutorial 04: Uncertainty and integration (solutions) • StatCompLab</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial 04: Uncertainty and integration (solutions)">
<meta property="og:description" content="Statistical Computing: Lab tutorial 4">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">StatCompLab</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">23.8.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Project01.html">StatComp Project 1 (2022/23): Simulation and sampling</a>
    <a class="dropdown-item" href="../articles/Project01Hints.html">StatComp Project 1 (2022/23): Hints</a>
    <a class="dropdown-item" href="../articles/Tutorial01.html">Tutorial 01: R and linear models</a>
    <a class="dropdown-item" href="../articles/Tutorial01Solutions.html">Tutorial 01: R and linear models (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial02.html">Tutorial 02: Optimization</a>
    <a class="dropdown-item" href="../articles/Tutorial02Solutions.html">Tutorial 02: Optimization (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial03.html">Tutorial 03: Monte Carlo integration</a>
    <a class="dropdown-item" href="../articles/Tutorial03Solutions.html">Tutorial 03: Monte Carlo integration (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial04.html">Tutorial 04: Uncertainty and integration</a>
    <a class="dropdown-item" href="../articles/Tutorial04Solutions.html">Tutorial 04: Uncertainty and integration (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial06.html">Tutorial 06: Prediction assessment with proper scores</a>
    <a class="dropdown-item" href="../articles/Tutorial06Solutions.html">Tutorial 06: Prediction assessment with proper scores (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial07.html">Tutorial 07: Data wrangling and cross validation</a>
    <a class="dropdown-item" href="../articles/Tutorial07Solutions.html">Tutorial 07: Data wrangling and cross validation (solutions)</a>
    <a class="dropdown-item" href="../articles/Tutorial08.html">Tutorial 08: Floating point computations and least squares</a>
    <a class="dropdown-item" href="../articles/Project_Example.html">StatComp Project Example: Numerical statistics</a>
    <a class="dropdown-item" href="../articles/Project_Example_Solution.html">StatComp Project Example Solution: Numerical Statistics</a>
    <a class="dropdown-item" href="../articles/Quiz1Solution.html">Quiz 1 Solution (StatComp 2021/22)</a>
    <a class="dropdown-item" href="../articles/T4sol.html">Tutorial 04: Uncertainty and integration (full solution)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/finnlindgren/StatCompLab/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tutorial 04: Uncertainty and integration (solutions)</h1>
                        <h4 data-toc-skip class="author">Finn
Lindgren</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/finnlindgren/StatCompLab/blob/HEAD/vignettes/Tutorial04Solutions.Rmd" class="external-link"><code>vignettes/Tutorial04Solutions.Rmd</code></a></small>
      <div class="d-none name"><code>Tutorial04Solutions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this lab session you will explore</p>
<ul>
<li>using RMarkdown to organise text and code</li>
<li>maximum likelihood estimator sampling distributions and approximate
confidence interval construction</li>
<li>Laplace approximation and importance sampling for approximate
Bayesian credible interval construction</li>
</ul>
<ol style="list-style-type: decimal">
<li>Clone your <code>lab04-*</code> repository from <a href="https://github.com/StatComp21/" class="external-link">https://github.com/StatComp21/</a>
either on your own computer (new Project from version control) or to <a href="https://rstudio.cloud" class="external-link">https://rstudio.cloud</a>
</li>
<li>If on rstudio.cloud, setup <code>GITHUB_PAT</code> credentials, like
before.</li>
<li>Upgrade/install the <code>StatCompLab</code> package, see <a href="https://finnlindgren.github.io/StatCompLab/">https://finnlindgren.github.io/StatCompLab/</a>
</li>
<li>The repository has two files, <code>RMDemo.Rmd</code> and
<code>my_code.R</code>. Make a copy of <code>RMDemo.Rmd</code>, and call
it <code>Lab4.Rmd</code>
</li>
<li>During this lab, modify the <code>Lab4.Rmd</code> document and add
new code and text commentary for the lab to the document. (You can
remove the demonstration parts of the file when you don’t need them
anymore, and/or keep a separate copy of it.) When pressing the “knit”
button, the RMarkdown file will be run in its own R environment, so you
need to include any needed <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> calls in a code chnk
in the file, normally an initial “setup” chunk.</li>
</ol>
<!--

The accompanying `Tutorial04Solutions` tutorial/vignette documents contain the
solutions explicitly, to make it easier to review the material after the workshops.
The separate `T4sol.Rmd` document at [https://github.com/finnlindgren/StatCompLab/blob/main/vignettes/articles/T4sol.Rmd](https://github.com/finnlindgren/StatCompLab/blob/main/vignettes/articles/T4sol.Rmd) is the source document for the standalone solution shown in `T4sol` on the `StatCompLab` website.  
-->
</div>
<div class="section level2">
<h2 id="three-alternatives-for-poisson-parameter-confidence-intervals">Three alternatives for Poisson parameter confidence intervals<a class="anchor" aria-label="anchor" href="#three-alternatives-for-poisson-parameter-confidence-intervals"></a>
</h2>
<p>Consider the Poisson model for observations <span class="math inline">\(\boldsymbol{y}=\{y_1,\dots,y_n\}\)</span>: <span class="math display">\[
\begin{aligned}
y_i &amp; \sim \mathsf{Poisson}(\lambda), \quad\text{independent for
$i=1,\dots,n$.}
\end{aligned}
\]</span> that has joint probability mass function <span class="math display">\[
p(\boldsymbol{y}|\lambda) = \exp(-n\lambda) \prod_{i=1}^n
\frac{\lambda^{y_i}}{y_i!}
\]</span> In the week 4 lecture, two parameterisations were considered.
We now add a third option:</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(\theta = \lambda\)</span>, and <span class="math inline">\(\widehat{\theta}_\text{ML}=\frac{1}{n}\sum_{i=1}^n
y_i = \overline{y}\)</span>
</li>
<li>
<span class="math inline">\(\theta = \sqrt{\lambda}\)</span>, and
<span class="math inline">\(\widehat{\theta}_\text{ML}=\sqrt{\overline{y}}\)</span>
</li>
<li>
<span class="math inline">\(\theta = \log(\lambda)\)</span>, and
<span class="math inline">\(\widehat{\theta}_\text{ML}=\log\left(\overline{y}\right)\)</span>
</li>
</ol>
<p>From the week 4 lecture, we know that the inverse expected Fisher
information is <span class="math inline">\(\lambda/n\)</span> for case 1
and <span class="math inline">\(1/(4n)\)</span> for case 2. For case 3,
show that the inverse expected Fisher information is <span class="math inline">\(1/(n\lambda)\)</span>.</p>
<hr>
<p><strong>Solution:</strong></p>
<p>For case 3, the negated log-likelihood is <span class="math display">\[
\widetilde{l}(\theta) = n e^\theta - \theta \sum_{i=1}^n y_i +
\text{constant}
\]</span> with 1st order derivative <span class="math display">\[
\frac{\partial}{\partial\theta}\widetilde{l}(\theta) = n e^\theta -
\sum_{i=1}^n y_i
\]</span> which shows that <span class="math inline">\(\widehat{\theta}_\text{ML}=\log(\overline{y})\)</span>,
and 2nd order derivative <span class="math display">\[
\frac{\partial^2}{\partial\theta^2}\widetilde{l}(\theta) = n e^\theta
\]</span> which is equal to <span class="math inline">\(n\lambda\)</span> for all <span class="math inline">\(y_i\)</span> values, so the inverse of the
expected Hessian is <span class="math inline">\(1/(n\lambda)\)</span>.</p>
<hr>
<div class="section level3">
<h3 id="interval-construction">Interval construction<a class="anchor" aria-label="anchor" href="#interval-construction"></a>
</h3>
<p>Use the approximation method for large <span class="math inline">\(n\)</span> from the lecture to construct
approximate confidence intervals for <span class="math inline">\(\lambda\)</span> using each of the three
parameterisations. Define three functions, CI1, CI2, and CI3, each
taking paramters</p>
<ul>
<li>
<code>y</code>: a vector of observed values</li>
<li>
<code>alpha</code>: the nominal error probability of the confidence
intervals</li>
</ul>
<p>To avoid having to specify <code>alpha</code> in a common case, you
can use <code>alpha = 0.05</code> in the function argument definition to
set a default value.</p>
<p>The function <code>pmax</code> may be useful (see its help text).</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CI1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">lambda_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">theta_interval</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">lambda_hat</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda_hat</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">theta_interval</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">CI2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">theta_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">theta_interval</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">theta_hat</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">theta_interval</span>, <span class="fl">0</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span><span class="va">CI3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">theta_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">theta_interval</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">theta_hat</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">theta_hat</span><span class="op">)</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">theta_interval</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr>
<p>You can use the following code to test your functions, storing each
interval as a row of a matrix with <code>rbind</code> (“bind” as “rows”,
see also <code>cbind</code> for combining columns):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, lambda <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0 2 2 2 4</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"Method 1"</span> <span class="op">=</span> <span class="fu">CI1</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>  <span class="st">"Method 2"</span> <span class="op">=</span> <span class="fu">CI2</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>  <span class="st">"Method 3"</span> <span class="op">=</span> <span class="fu">CI3</span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">CI</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lower"</span>, <span class="st">"Upper"</span><span class="op">)</span></span></code></pre></div>
<p>We can print the result as a table in our RMarkdown by using a
separate codechunk, calling the <code><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">knitr::kable</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">CI</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Lower</th>
<th align="right">Upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Method 1</td>
<td align="right">0.7604099</td>
<td align="right">3.239590</td>
</tr>
<tr class="even">
<td align="left">Method 2</td>
<td align="right">0.9524829</td>
<td align="right">3.431663</td>
</tr>
<tr class="odd">
<td align="left">Method 3</td>
<td align="right">1.0761094</td>
<td align="right">3.717094</td>
</tr>
</tbody>
</table>
<p>Will all three methods always produce a valid interval? Consider the
possible values of <span class="math inline">\(\overline{y}\)</span>.
Experiment with different values of <code>n</code> and
<code>lambda</code> in the simulation of <code>y</code>.</p>
<hr>
<p><strong>Solution:</strong></p>
<p>When <span class="math inline">\(\overline{y}=0\)</span>, the first
method produces a single point as “interval”.</p>
<p>The third method fails if <span class="math inline">\(\overline{y}=0\)</span>, due to log of zero.</p>
<p>This can happen when <span class="math inline">\(n\)</span> or <span class="math inline">\(\lambda\)</span> are close to zero.</p>
<hr>
<p>For each approximate confidence interval construction method, we
might ask the question of whether it fulfils the definition of an actual
confidence interval construction method; that <span class="math inline">\(\mathsf{P}_{\boldsymbol{y}|\theta}(\theta\in
\text{CI}(\boldsymbol{y})|\theta)\geq 1-\alpha\)</span> for all <span class="math inline">\(\theta\)</span> (or at least for a relevant subset
of the parameter space). In coursework project 1, you will investigate
the accuracy of some approximate confidence interval construction
methods.</p>
</div>
</div>
<div class="section level2">
<h2 id="bayesian-credible-intervals">Bayesian credible intervals<a class="anchor" aria-label="anchor" href="#bayesian-credible-intervals"></a>
</h2>
<p>Assume a true value of <span class="math inline">\(\lambda=10\)</span>, and simulate a sample of
<span class="math inline">\(\boldsymbol{y}\)</span> of size <span class="math inline">\(n=5\)</span>.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="co"># Actual values will depend on if set.seed() was used at the beginning of the document</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 11  7 11  8  8</span></span></code></pre>
<hr>
<p>Now consider a Bayesian version of the Poisson model, with prior
model <span class="math display">\[
\lambda \sim \mathsf{Exp}(a)
\]</span> that has probability density function <span class="math inline">\(p(\lambda) = a \exp(-a \lambda)\)</span>.</p>
<p>One can show that the exact posterior distribution for <span class="math inline">\(\lambda\)</span> given <span class="math inline">\(\boldsymbol{y}\)</span> is a <span class="math inline">\(\mathsf{Gamma}(1 + \sum_{i=1}^n y_i, a +
n)\)</span> distribution (using the shape&amp;rate parameterisation),
and credible intervals can be constructed from quantiles of this
distribution.</p>
<p>In cases where the theoretical construction is impractical, an
alternative is to instead construct samples from the posterior
distribution, and extract empirical quantiles from this sample. Here, we
will use importance sampling to achieve this.</p>
<p>Let <span class="math inline">\(\theta=\log(\lambda)\)</span>, so
that <span class="math inline">\(\lambda=\exp(\theta)\)</span>. Show
that the prior probability density for <span class="math inline">\(\theta\)</span> is <span class="math inline">\(p(\theta)=a \exp\left( \theta-ae^\theta
\right)\)</span>.</p>
<div class="section level3">
<h3 id="gaussian-approximation">Gaussian approximation<a class="anchor" aria-label="anchor" href="#gaussian-approximation"></a>
</h3>
<hr>
<p><strong>Solution:</strong></p>
<p><em>Alternative 1</em>: From probability theory, we know that <span class="math inline">\(p(\theta)=p(\lambda)
\frac{d\lambda(\theta)}{d\theta}\)</span>, so that <span class="math display">\[
p(\theta) = a \exp(-a\lambda) \exp(\theta) = a \exp\left(
\theta-ae^\theta \right)
\]</span></p>
<p><em>Alternative 2</em>: First, we derive the CDF: <span class="math inline">\(\mathsf{P}(\theta \leq x)=\mathsf{P}(\log(\lambda)
\leq x)=\mathsf{P}(\lambda \leq e^x) = 1 - \exp(-a e^x)\)</span>, from
the CDF for the Exponential distribution. Taking the derivative with
respect to <span class="math inline">\(x\)</span> gives the density
<span class="math inline">\(p_\theta(x)=-\exp(-a e^x) \frac{d}{dx} (-a
e^x) = \exp(-a e^x) (a e^x) = a \exp(x - a e^x)\)</span>, which is the
needed result.</p>
<hr>
<p>The posterior density function for <span class="math inline">\(\theta\)</span> is <span class="math display">\[
p(\theta|\boldsymbol{y}) = \frac{p(\theta)
p(\boldsymbol{y}|\theta)}{p(\boldsymbol{y})}
\]</span> with log-density <span class="math display">\[
\log p(\theta|\boldsymbol{y}) = \text{const} + \theta (1 +
n\overline{y}) - (a+n)\exp(\theta) ,
\]</span> and by taking derivatives we find the mode at <span class="math inline">\(\widetilde{\theta}=\log\left(\frac{1+n\overline{y}}{a+n}\right)\)</span>,
and negated Hessian <span class="math inline">\(1+n\overline{y}\)</span>
at the mode.</p>
<p>With this information we can construct a Gaussian approximation to
the posterior distribution, <span class="math inline">\(\widetilde{p}(\theta|\boldsymbol{y})\sim\mathsf{Normal}(\widetilde{\theta},\frac{1}{1+n\overline{y}})\)</span>.</p>
</div>
<div class="section level3">
<h3 id="importance-sampling">Importance sampling<a class="anchor" aria-label="anchor" href="#importance-sampling"></a>
</h3>
<p>Simulate a sample <span class="math inline">\(\boldsymbol{x}=\{x_1,\dots,x_m\}\)</span> from
this Gaussian approximation of the posterior distribution, for some
large <span class="math inline">\(m &gt; 10000\)</span>, with
hyperparameter <span class="math inline">\(a=1/5\)</span>.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">20000</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">n</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<hr>
<p>We need to calculate unnormalised <em>importance weights</em> <span class="math inline">\(w_k\)</span>, <span class="math inline">\(k=1,\dots,m\)</span>, <span class="math display">\[
w_k =
\left.\frac{p(\theta)p(\boldsymbol{y}|\theta)}{\widetilde{p}(\theta|\boldsymbol{y})}\right|_{\theta=x_k}
.
\]</span> Due to lack of normalisation, these “raw” weights cannot be
represented accurately in the computer. To get around that issue, first
compute the logarithm of the weights, <span class="math inline">\(\log(w_k)\)</span>, and then new, equivalent
unnormalised weights <span class="math inline">\(\widetilde{w}_k=\exp[\log(w_k) - \max_j
\log(w_j)]\)</span>.</p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_weights</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">n</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_weights</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">log_weights</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<hr>
<p>Look at the help text for the function <code>wquantile</code> (in the
StatCompLab package, from version 0.4.0) that computes quantiles from a
weighted sample, and construct a 95% credible interval for <span class="math inline">\(\theta\)</span> using the <span class="math inline">\(\boldsymbol{x}\)</span> sample and associate
weights, and then transform it into a credible interval for <span class="math inline">\(\lambda\)</span></p>
<hr>
<p><strong>Solution:</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta_interval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wquantile.html">wquantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span>, weights <span class="op">=</span> <span class="va">weights</span><span class="op">)</span></span>
<span><span class="va">theta_interval</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.873696 2.448506</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda_interval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">theta_interval</span><span class="op">)</span></span>
<span><span class="va">lambda_interval</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  6.512323 11.571043</span></span></code></pre>
<hr>
</div>
<div class="section level3">
<h3 id="cumulative-distribution-function-comparison">Cumulative distribution function comparison<a class="anchor" aria-label="anchor" href="#cumulative-distribution-function-comparison"></a>
</h3>
<p>With <code>ggplot</code>, use <code>geom_function</code> to plot the
theoretical posterior cumulative distribution function for <span class="math inline">\(\lambda\)</span> (the CDF from the Gamma
distribution given above, see <code><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">pgamma()</a></code>) and compare it to
the approximation given by the importance sampling. The
<code><a href="../reference/stat_ewcdf.html">stat_ewcdf()</a></code> function from the StatCompLab should be used
to plot the cdf for the weighted sample <span class="math inline">\(\lambda_k=\exp(x_k)\)</span>, with (unnormalised)
weights <span class="math inline">\(w_k\)</span>. Also include the
unweighted sample, with <code>stat_ecwf()</code>. How close does the
approximations come to the true posterior distribution?</p>
<hr>
<p><strong>Solution:</strong></p>
<p>The importance sampling version is virtually indistinguishable from
the true posterior distribution. The unweighted sample is very close to
the true posterior distribution; for this model, the Gaussian
approximation of the posterior distribution of <span class="math inline">\(\log(\lambda)\)</span> is an excellent
approximation even before we add the importance sampling step.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, weights <span class="op">=</span> <span class="va">weights</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"CDF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">geom_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">pgamma</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, rate <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Theory"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/stat_ewcdf.html">stat_ewcdf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lambda</span>, weights <span class="op">=</span> <span class="va">weights</span>, col <span class="op">=</span> <span class="st">"Importance"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lambda</span>, col <span class="op">=</span> <span class="st">"Unweighted"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial04Solutions_files/figure-html/ecdf-show-1.png" width="576"></p>
<hr>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Finn Lindgren.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
